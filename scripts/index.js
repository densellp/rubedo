import{system as Mr}from"@minecraft/server";import{world as uo}from"@minecraft/server";var v="-";import{world as lo}from"@minecraft/server";import{ItemStack as Ft,MinecraftItemTypes as zt}from"@minecraft/server";import{BlockLocation as ao}from"@minecraft/server";var Bt=32e3,se="rubedo:database",N=new ao(0,-64,0),ve=128;import{system as _t,world as $t}from"@minecraft/server";import{BlockLocation as We,MinecraftDimensionTypes as X,system as Nt,world as J}from"@minecraft/server";var y={overworld:J.getDimension(X.overworld),nether:J.getDimension(X.nether),theEnd:J.getDimension(X.theEnd),"minecraft:overworld":J.getDimension(X.overworld),"minecraft:nether":J.getDimension(X.nether),"minecraft:the_end":J.getDimension(X.theEnd)};var Mt={y:317098e-16,w:6048e5,d:864e5,h:36e5,m:6e4,s:1e3,ms:1};function ae(t){let e=t.split(","),n=0;for(let o of e){let r=parseInt(o.match(/\d+/)[0]),i=o.match(/[a-zA-Z]+/)[0];if(!Mt[i])throw new Error(`Invalid duration unit: ${i}`);n+=Mt[i]*r}return n}function Z(t){return new Date(t).toString()}function Te(t){return new We(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}function Dt(t){return new Promise(e=>{let n=Nt.runSchedule(()=>{e(),Nt.clearRunSchedule(n)},t)})}function Lt(t,e){return t instanceof We||e instanceof We?~~t.x===~~e.x&&~~t.y===~~e.y&&~~t.z===~~e.z:t.x===e.x&&t.y===e.y&&t.z===e.z}function co(t,e){return[t.x,e.x]=[Math.min(t.x,e.x),Math.max(t.x,e.x)],[t.y,e.y]=[Math.min(t.y,e.y),Math.max(t.y,e.y)],[t.z,e.z]=[Math.min(t.z,e.z),Math.max(t.z,e.z)],[t,e]}function Se(t,e,n){let[o,r]=co(e,n),{x:i,y:s,z:c}=t;return i>=o.x&&i<=r.x&&s>=o.y&&s<=r.y&&c>=o.z&&c<=r.z}function Ot(t,e){return t.match(new RegExp(".{1,"+e+"}","g"))}var Y={},Pe=!1;_t.run(async()=>{try{await y.overworld.runCommandAsync("testfor @a"),Pe=!0;for(let[t,e]of Object.entries(Y))e(),delete Y[t]}catch{let e=$t.events.entityCreate.subscribe(n=>{_t.run(()=>{Pe=!0;for(let[o,r]of Object.entries(Y))r(),delete Y[o];$t.events.entityCreate.unsubscribe(e)})})}});var w=class{static async awaitLoad(){if(!Pe)return new Promise(e=>{w.subscribe(e)})}static subscribe(e){if(Pe){e();return}let n=Object.keys(Y).length;return Y[n]=e,n}static unsubscribe(e){delete Y[e]}};var g=class{constructor(e){this.tableName=e;this.tableName=e,this.MEMORY=null,this.QUEUE=[],w.subscribe(async()=>{await this.initData(),this.QUEUE.forEach(n=>n())})}static createTableEntity(e,n){let o=y.overworld.spawnEntity(se,N);return o.setDynamicProperty("tableName",e),o.nameTag=`\xA7aDatabase Table: ${e}\xA7r`,n&&o.setDynamicProperty("index",n),o}static getTableEntities(e){return y.overworld.getEntitiesAtBlockLocation(N).filter(n=>n.typeId==se&&n.getDynamicProperty("tableName")==e)}async addQueueTask(){return new Promise(e=>{this.QUEUE.push(e)})}async saveData(){this.MEMORY||await this.addQueueTask();let e=g.getTableEntities(this.tableName),n=Ot(JSON.stringify(this.MEMORY),Bt),o=Math.ceil(n.length/ve)-e.length;if(o>0)for(let i=0;i<o;i++)e.push(g.createTableEntity(this.tableName));let r=0;for(let[i,s]of e.entries()){let c=s.getComponent("inventory").container;for(;r<n.length&&c.size>0;){let d=new Ft(zt.acaciaBoat);d.nameTag=n[r],c.setItem(i,d),r++}for(let d=c.size;d<ve;d++)c.setItem(d,new Ft(zt.stick,0));s.setDynamicProperty("index",i)}for(let i=e.length-1;i>=r/ve;i--)e[i].triggerEvent("despawn")}async initData(){let e=g.getTableEntities(this.tableName).sort((r,i)=>r.getDynamicProperty("index")-i.getDynamicProperty("index")),n="";for(let r of e){let i=r.getComponent("inventory").container;for(let s=0;s<i.size;s++){let c=i.getItem(s);!c||(n=n+c.nameTag)}}let o=n==""?{}:JSON.parse(n);return this.MEMORY=o,o}async set(e,n){return this.MEMORY[e]=n,this.saveData()}get(e){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `getAsync` instead!");return this.MEMORY[e]}async getSync(e){return this.MEMORY?this.get(e):(await this.addQueueTask(),this.MEMORY[e])}keys(){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `keysSync` instead!");return Object.keys(this.MEMORY)}async keysSync(){return this.MEMORY?this.keys():(await this.addQueueTask(),Object.keys(this.MEMORY))}values(){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `valuesSync` instead!");return Object.values(this.MEMORY)}async valuesSync(){return this.MEMORY?this.values():(await this.addQueueTask(),Object.values(this.MEMORY))}has(e){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `hasSync` instead!");return Object.keys(this.MEMORY).includes(e)}async hasSync(e){return this.MEMORY?this.has(e):(await this.addQueueTask(),Object.keys(this.MEMORY).includes(e))}collection(){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `collectionSync` instead!");return this.MEMORY}async collectionSync(){return this.MEMORY?this.collection():(await this.addQueueTask(),this.MEMORY)}async delete(e){let n=delete this.MEMORY[e];return await this.saveData(),n}async clear(){return this.MEMORY={},this.saveData()}};function Vt(t){return[...lo.getPlayers()].find(e=>e.name===t)}var F=class{constructor(e="literal"){this.name=e;this.typeName="literal";this.name=e}matches(e){return{success:this.name==e}}fail(e){return`${e} should be ${this.name}!`}},ce=class{constructor(e="string"){this.name=e;this.typeName="string";this.name=e}matches(e){return{success:e&&e!="",value:e}}fail(e){return"Value must be of type string!"}},le=class{constructor(e="integer"){this.name=e;this.typeName="int";this.name=e}matches(e){return{success:!isNaN(e),value:parseInt(e)}}fail(e){return"Value must be valid number!"}},Qe=class{constructor(e="float"){this.name=e;this.typeName="float";this.name=e}matches(e){return{success:Boolean(e?.match(/^\d+\.\d+$/)?.[0]),value:parseInt(e)}}fail(e){return"Value must be valid float!"}},K=class{constructor(e="location"){this.name=e;this.typeName="location";this.name=e}matches(e){return{success:/^([~^]{0,1}(-\d)?(\d*)?(\.(\d+))?)$/.test(e),value:e}}fail(e){return"Value needs to be a valid number, value can include: [~,^]"}},me=class{constructor(e="boolean"){this.name=e;this.typeName="boolean";this.name=e}matches(e){return{success:Boolean(e?.match(/^(true|false)$/)?.[0]),value:e=="true"}}fail(e){return`"${e}" can be either "true" or "false"`}},Xe=class{constructor(e="player"){this.name=e;this.typeName="Player";this.name=e}matches(e){return{success:!!Vt(e),value:Vt(e)}}fail(e){return`player: "${e}", is not in this world`}},Je=class{constructor(e="target"){this.name=e;this.typeName="Target";this.name=e}matches(e){return{success:Boolean(e?.match(/^(@.|"[\s\S]+")$/)?.[0]),value:e}}fail(e){return`${e} is not a valid target`}},ue=class{constructor(e="array",n){this.name=e;this.types=n;this.typeName="string";this.name=e,this.types=n,this.typeName=n.join(" | ").replace(/(.{25})..+/,"$1...")}matches(e){return{success:this.types.includes(e),value:e}}fail(e){return`"${e}" must be one of these values: ${this.types.join(" | ")}`}},Ze=class{constructor(e){this.name=e;this.typeName="Duration"}matches(e){return{success:/^(\d+[hdysmw],?)+$/.test(e),value:e}}fail(e){return`"${e}" must be a value like "10d" or "3s" the first part is the length second is unit`}},et=class{constructor(e="playerName"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!new g("ids").get(e),value:e}}fail(e){return`player: "${e}" has never played this world before! Tip: if the name has spaces in it use quotes around name!`}},f={string:ce,int:le,float:Qe,location:K,boolean:me,player:Xe,target:Je,array:ue,duration:Ze,playerName:et};var Ae=class{constructor(e){this.data=e,this.sender=e.sender}reply(e){this.sender.tell(e)}};function jt(t,e){try{return t.slice(e.length).trim().match(/"[^"]+"|[^\s]+/g).map(n=>n.replace(/"(.+)"/,"$1").toString())}catch{return[]}}function Yt(t,e){t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.unknown",with:[`${e}`]}]})}function tt(t,e){t.tell({rawtext:[{text:e.data.invalidPermission?e.data.invalidPermission:`\xA7cYou do not have permission to use "${e.data.name}"`}]})}function Kt(t,e,n,o,r){if(t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.syntax",with:[`${v}${e.data.name} ${o.slice(0,r).join(" ")}`,o[r]??" ",o.slice(r+1).join(" ")]}]}),n.children.length>1||!o[r]){let i=n.children.map(s=>s.type instanceof F?s.type.name:s.type?.typeName);t.tell(`\xA7c"${o[r]??"undefined"}" is not valid! Argument "${[...new Set(n.children.map(s=>s.type.name))][0]}" can be typeof: "${i.join('", "')}"`)}else t.tell(`\xA7c${n.children[0]?.type?.fail(o[r])}`)}function mo([t,e,n],{location:o,viewVector:r}){if(!t||!e||!t)return null;let i=[o.x,o.y,o.z],s=[r.x,r.y,r.z],c=[t,e,n].map(h=>{let E=parseFloat(h);return isNaN(E)?0:E}),d=[t,e,n].map((h,E)=>h.includes("~")?c[E]+i[E]:h.includes("^")?c[E]+s[E]:c[E]);return{x:d[0],y:d[1],z:d[2]}}function Gt(t,e,n,o){let r=e[e.length-1]??o,i=[];for(let[s,c]of e.entries())if(!c.type.name.endsWith("*")){if(c.type instanceof K){i.push(mo([t[s],t[s+1],t[s+2]],n.sender));continue}c.type instanceof F||i.push(c.type.matches(t[s]).value??t[s])}r.callback(new Ae(n),...i)}var G=[];uo.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(v))return;t.cancel=!0;let e=jt(t.message,v),n=G.find(c=>c.depth==0&&(c.data.name==e[0]||c.data?.aliases?.includes(e[0]))),o={message:t.message,sendToTargets:t.sendToTargets,sender:t.sender,targets:t.targets};if(!n)return Yt(t.sender,e[0]);if(!n.data?.requires(t.sender))return tt(o.sender,n);e.shift();let r=[],i=(c,d)=>{if(c.children.length>0){let h=c.children.find(E=>E.type.matches(e[d]).success);return!h&&!e[d]&&c.callback?void 0:h?h.data?.requires(o.sender)?(r.push(h),i(h,d+1)):(tt(o.sender,h),"fail"):(Kt(o.sender,n,c,e,d),"fail")}};i(n,0)!="fail"&&Gt(e,r,o,n)});import{ItemStack as Eo,MinecraftItemTypes as vo,system as fn,world as To}from"@minecraft/server";var Ht="rubedo:gui",de="rubedo:inventory";import{system as Xt}from"@minecraft/server";import{system as fo}from"@minecraft/server";var nt={},Ut={},z={};function po(t,e,n){if(e.length!=n.length)return[];let o=[];for(let r=0;r<n.length;r++){if(e[r]?.item?.amount<n[r]?.item?.amount||e[r]?.item?.amount>n[r]?.item?.amount&&e[r]?.item?.amount!=0){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"fluctuation"};o.push(i),z[t.id]=i;continue}if(n[r].uid!=e[r].uid)if(e[r]?.item&&n[r]?.item){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"swap"};o.push(i),z[t.id]=i}else if(n[r]?.item){if(n[r]?.item)if(z[t.id]?.changeType=="delete"&&z[t.id]?.uid==n[r].uid){let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"move"};o.push(i),z[t.id]=i;continue}else{let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"put"};o.push(i),z[t.id]=i}}else{let i={slot:r,uid:e[r].uid,item:e[r].item,changeType:"delete"};o.push(i),z[t.id]=i}}return o}function go(t){if(!t)return"";let e=[];return e.push(t.typeId),e.push(t.nameTag),e.push(t.data),e.push(t.getLore().join("")),e.join("")}function yo(t){let e=[];for(let n=0;n<t.size;n++){let o=t.getItem(n);e[n]={uid:go(o),item:o}}return e}fo.runSchedule(()=>{for(let t of Object.values(nt))for(let e of y.overworld.getEntities(t.entities)){let n=yo(e.getComponent("inventory").container),o=po(e,Ut[e.id]??n,n);if(Ut[e.id]=n,o.length!=0){if(e.hasTag("skipCheck")){e.removeTag("skipCheck"),delete z[e.id];continue}for(let r of o)t.callback(e,r)}}},5);var fe=class{static subscribe(e,n){let o=Date.now();return nt[o]={callback:n,entities:e},o}static unsubscribe(e){delete nt[e]}};import{Location as ho}from"@minecraft/server";var M={},ee={};function qt(t){return t.getComponent("minecraft:inventory").container.getItem(t.selectedSlot)}async function Wt(t,e){try{let n=t.getComponent("minecraft:inventory").container,o=[];for(let r=0;r<n.size;r++){let i=n.getItem(r);!i||i?.typeId==e?.typeId&&(o.push({slot:r,item:i}),n.setItem,r<9?t.runCommandAsync(`replaceitem entity @s slot.hotbar ${r} air`):t.runCommandAsync(`replaceitem entity @s slot.inventory ${r-9} air`))}await t.runCommandAsync(`clear @s ${e?.typeId} ${e.data} ${e.amount}`);for(let r of o)n.setItem(r.slot,r.item)}catch{[...t.dimension.getEntities({type:"minecraft:item",location:new ho(t.location.x,t.location.y,t.location.z),maxDistance:2,closest:1})].forEach(o=>o.kill())}}function Qt(t,e){return t.getComponent("minecraft:inventory").container.getItem(e)}var xe=class{constructor(e,n,o){this.gui=e,this.slot=n,this.change=o}message(e){this.gui.player.tell(e)}getItemAdded(){return this.slot.item?null:this.gui.entity.getComponent("minecraft:inventory").container.getItem(this.change.slot)}GiveAction(e=this.slot.item.itemStack){this.gui.player.getComponent("minecraft:inventory").container.addItem(e)}TakeAction(e=null){this.gui.player.getComponent("minecraft:inventory").container.addItem(this.slot.item.itemStack),this.gui.page.slots[this.change.slot]=null,e&&e.delete(this.slot.item.components.dbKey)}PageAction(e,n){this.gui.setPage(e,n)}CloseAction(){this.gui.despawn()}SetAction(){this.gui.entity.getComponent("minecraft:inventory").container.setItem(this.change.slot,this.slot.item.itemStack)}async FormAction(e){return this.CloseAction(),await Dt(5),await e.show(this.gui.player)}};var te=class{static spawnEntity(e){try{return e.dimension.spawnEntity(de,e.headLocation)}catch{return null}}constructor(e){this.player=e,this.entity=te.spawnEntity(e),this.entity&&(this.hasChestOpen=!1,this.setPage("home")),this.runScheduleId=Xt.runSchedule(()=>{if(!this.entity)return this.despawn();if(this.player.getComponent("mark_variant").value==1)this.hasChestOpen||(this.slotChangeEvent=fe.subscribe({type:de},(n,o)=>{n.id==this.entity.id&&this.onSlotChange(o)})),this.hasChestOpen=!0;else try{this.entity.teleport(this.player.headLocation,this.player.dimension,this.player.rotation.x,this.player.rotation.y,!0)}catch{this.despawn()}},5)}setPage(e,n){let o=this.entity.getComponent("inventory").container;for(let i=0;i<o.size;i++)o.setItem(i,T);if(!Object.keys(ee).includes(e))throw new Error(`pageId ${e} does not exist!`);let r=ee[e];this.page=r,r.fillType(this.entity,r,n),this.entity.nameTag="size:54"}onSlotChange(e){let n=this.page.slots[e.slot];if(!n)this.entity.getComponent("inventory").container.setItem(e.slot,T);else if(e.changeType=="delete"){if(n.item&&Wt(this.player,e.item),!n.item&&!Qt(this.entity,e.slot))return;n.action(new xe(this,n,e))}}despawn(){try{this.entity?.triggerEvent("despawn")}catch{}try{delete M[this.player.name]}catch{}this.runScheduleId&&Xt.clearRunSchedule(this.runScheduleId),this.slotChangeEvent&&fe.unsubscribe(this.slotChangeEvent)}};import{ItemStack as bo}from"@minecraft/server";var x=class{constructor(e,n={},o){this.itemType=e,this.components=n,this.setItemStack=o}get itemStack(){if(this.setItemStack)return this.setItemStack;let e=new bo(this.itemType);if(this.components){e.amount=this.components?.amount??1,e.data=this.components?.data??0,e.nameTag=this.components?.nameTag,e.setLore(this.components?.loreList??[]);let n=e.getComponent("enchantments").enchantments;for(let o of this.components?.enchantments??[])n.addEnchantment(o);e.getComponent("enchantments").enchantments=n}return e}};function Jt(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,T);continue}o.setItem(r,i.item.itemStack)}}var H=class{constructor(e,n=Jt){if(Object.keys(ee).includes(e))throw new Error(`Page: ${e}, Already exists!`);this.id=e,this.fillType=n,this.slots=[],ee[e]=this}setSlots(e,n,o){let r=n?{item:n,action:o}:null;for(let i of e)this.slots[i]=r;return this}};import{MinecraftItemTypes as Zt}from"@minecraft/server";var Qi=new H("home").setSlots([22],new x(Zt.enderChest,{nameTag:"\xA7l\xA7bInventory Viewer"}),t=>{t.PageAction("moderation:see")}).setSlots([54],new x(Zt.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});import{world as V,Player as Io,BlockLocation as ln,MinecraftBlockTypes as wo,GameMode as Co}from"@minecraft/server";import{BlockLocation as on,MinecraftBlockTypes as ko}from"@minecraft/server";var en={doorsAndSwitches:!0,openContainers:!0,pvp:!1,allowedEntities:["minecraft:player","minecraft:npc","minecraft:item","rubedo:inventory","rubedo:database"]},tn=["minecraft:acacia_door","minecraft:acacia_trapdoor","minecraft:acacia_button","minecraft:birch_door","minecraft:birch_trapdoor","minecraft:birch_button","minecraft:crimson_door","minecraft:crimson_trapdoor","minecraft:crimson_button","minecraft:dark_oak_door","minecraft:dark_oak_trapdoor","minecraft:dark_oak_button","minecraft:jungle_door","minecraft:jungle_trapdoor","minecraft:jungle_button","minecraft:mangrove_door","minecraft:mangrove_trapdoor","minecraft:mangrove_button","minecraft:spruce_door","minecraft:spruce_trapdoor","minecraft:spruce_button","minecraft:warped_door","minecraft:warped_trapdoor","minecraft:warped_button","minecraft:wooden_door","minecraft:wooden_button","minecraft:trapdoor","minecraft:iron_door","minecraft:iron_trapdoor","minecraft:polished_blackstone_button","minecraft:lever"],nn=["minecraft:chest","minecraft:ender_chest","minecraft:barrel","minecraft:trapped_chest","minecraft:dispenser","minecraft:dropper","minecraft:furnace","minecraft:blast_furnace","minecraft:lit_furnace","minecraft:lit_blast_furnace","minecraft:hopper","minecraft:shulker_box","minecraft:undyed_shulker_box","minecraft:lit_smoker","minecraft:smoker"];var a={config:new g("config"),freezes:new g("freezes"),mutes:new g("mutes"),bans:new g("bans"),regions:new g("regions"),roles:new g("roles"),tasks:new g("tasks"),npcs:new g("npcs"),ids:new g("ids"),logs:new g("logs"),protections:new g("protections")};var U=[],Re=!1,ot=-64,rt=320,p=class{static async getAllRegionsSync(){if(Re)return U;let e=(await a.regions.valuesSync()).map(n=>new p(n.from,n.to,n.dimensionId,n.permissions,n.key));return e.forEach(n=>{U.push(n)}),Re=!0,e}static getAllRegions(){if(Re)return U;let e=a.regions.values().map(n=>new p(n.from,n.to,n.dimensionId,n.permissions,n.key));return e.forEach(n=>{U.push(n)}),Re=!0,e}static blockLocationInRegion(e,n){return this.getAllRegions().find(o=>o.dimensionId==n&&Se(e,{x:o.from.x,y:ot,z:o.from.z},{x:o.to.x,y:rt,z:o.to.z}))}static async blockLocationInRegionSync(e,n){return(await this.getAllRegionsSync()).find(o=>o.dimensionId==n&&Se(e,{x:o.from.x,y:ot,z:o.from.z},{x:o.to.x,y:rt,z:o.to.z}))}static async removeRegionAtBlockLocation(e,n){let o=this.blockLocationInRegion(e,n);return o?a.regions.delete(o.key):!1}constructor(e,n,o,r,i){this.from=e,this.to=n,this.dimensionId=o,this.permissions=r??en,this.key=i||Date.now().toString(),i||this.update().then(()=>{Be(),U.push(this)})}async update(){return a.regions.set(this.key,{key:this.key,from:this.from,dimensionId:this.dimensionId,permissions:this.permissions,to:this.to})}async delete(){let e=a.regions.get(this.key),n=new on(e.from.x,e.dimensionId=="minecraft:overworld"?-64:0,e.from.z),o=new on(e.to.x,e.dimensionId=="minecraft:overworld"?-64:0,e.to.z);for(let r of n.blocksBetween(o))y[e.dimensionId].getBlock(r)?.setType(ko.bedrock);return U=U.filter(r=>r.key!=this.key),a.regions.delete(this.key)}entityInRegion(e){return this.dimensionId==e.dimension.id&&Se(e.location,{x:this.from.x,y:ot,z:this.from.z},{x:this.to.x,y:rt,z:this.to.z})}changePermission(e,n){this.permissions[e]=n,this.update()}};var L=class{static getTasks(){return a.tasks.get("changePlayerRole")??[]}static getPlayersRoleToSet(e){return L.getTasks().find(o=>o.playerName==e)?.role}constructor(e,n){let o=L.getTasks();o.push({playerName:e,role:n}),a.tasks.set("changePlayerRole",o)}};import{MinecraftBlockTypes as it,MinecraftItemTypes as u}from"@minecraft/server";var Ne="https://discord.gg/dMa3A5UYKX",rn=[u.beehive.id,u.beeNest.id,u.axolotlBucket.id,u.codBucket.id,u.tadpoleBucket.id,u.tropicalFishBucket.id,u.salmonBucket.id,u.pufferfishBucket.id],sn=[u.allow.id,u.barrier.id,u.borderBlock.id,u.debugStick?.id??"minecraft:debug_stick",u.deny.id,u.jigsaw.id,u.lightBlock.id,u.commandBlock.id,u.repeatingCommandBlock.id,u.chainCommandBlock.id,u.commandBlockMinecart.id,u.structureBlock.id,u.structureVoid.id,u.bedrock.id,u.endPortalFrame.id,"minecraft:info_update","minecraft:info_update2","minecraft:reserved3","minecraft:reserved4","minecraft:reserved6","minecraft:movingBlock","minecraft:moving_block","minecraft:movingblock","minecraft:piston_arm_collision","minecraft:piston_arm_collision","minecraft:pistonarmcollision","minecraft:stickyPistonArmCollision","minecraft:sticky_piston_arm_collision","minecraft:unknown","minecraft:glowingobsidian","minecraft:invisible_bedrock","minecraft:invisiblebedrock","minecraft:netherreactor","minecraft:portal","minecraft:fire","minecraft:water","minecraft:lava","minecraft:flowing_lava","minecraft:flowing_water","minecraft:soul_fire"],an=[it.dispenser.id],cn=[it.bedrock.id,it.barrier.id,"minecraft:invisiblebedrock","minecraft:movingBlock","minecraft:movingblock","minecraft:moving_block"],us=[u.chest.id,u.trappedChest.id,u.barrel.id,u.dispenser.id,u.dropper.id,u.furnace.id,"minecraft:lit_furnace",u.blastFurnace.id,"minecraft:lit_blast_furnace",u.smoker.id,"minecraft:lit_smoker",u.hopper.id,u.shulkerBox.id,u.undyedShulkerBox.id];var Me={aquaAffinity:1,baneOfArthropods:5,binding:1,blastProtection:4,channeling:1,depthStrider:3,efficiency:5,featherFalling:4,fireAspect:2,fireProtection:4,flame:1,fortune:3,frostWalker:2,impaling:5,infinity:1,knockback:2,looting:3,loyalty:4,luckOfTheSea:3,lure:3,mending:1,multishot:1,piercing:4,power:5,projectileProtection:4,protection:4,punch:2,quickCharge:3,respiration:3,riptide:3,sharpness:5,silkTouch:1,smite:5,soulSpeed:3,swiftSneak:4,thorns:3,unbreaking:3,vanishing:1};function j(t,e=[],n){if(pe(t))return console.warn("[WARNING]: TRIED TO KICK OWNER"),t.tell("You have been tried to kick, but you cant!"),n?.();try{t.runCommandAsync(`kick "${t.name}" \xA7r${e.join(`
`)}`),t.triggerEvent("kick")}catch(o){if(t.triggerEvent("kick"),!/"statusCode":-2147352576/.test(o))return;n&&n()}}function l(t){return t instanceof Io?a.roles.get(t.name)??"member":a.roles.get(t)??"member"}function ne(t,e){if(typeof t=="string"){a.roles.set(t,e);let n=[...V.getPlayers()].find(o=>o.name==t);n?n.setDynamicProperty("role",e):new L(t,e)}else a.roles.set(t.name,e),t.setDynamicProperty("role",e)}function pe(t){return V.getDynamicProperty("worldsOwner")==t.id}function st(){let t=V.getDynamicProperty("worldsOwner");return!t||t==""?null:t}function mn(){let t=st();if(!t)return null;let e=a.ids.collection();return Object.keys(e).find(n=>e[n]===t)}function ge(t){if(!t)return V.setDynamicProperty("worldsOwner","");V.setDynamicProperty("worldsOwner",t.id.toString())}function De(){return V.getDynamicProperty("isLockDown")??!1}function at(t){V.setDynamicProperty("isLockDown",t)}function Be(){for(let t of p.getAllRegions()){let e=new ln(t.from.x,t.dimensionId=="minecraft:overworld"?-64:0,t.from.z),n=new ln(t.to.x,t.dimensionId=="minecraft:overworld"?-64:0,t.to.z);for(let o of e.blocksBetween(n))y[t.dimensionId].getBlock(o)?.setType(wo.deny)}}function C(t){switch(t){case"banned_items":return a.config.get("banned_items")??sn;case"banned_blocks":return a.config.get("banned_blocks")??cn;case"enchantments":return a.config.get("enchantments")??Me;case"appealLink":return a.config.get("appealLink")??Ne}}function q(t,e){a.config.set(t,e)}function un(t){return C("enchantments")[t.type.id]??t.type.maxLevel}function dn(t){return Object.values(Co).find(e=>[...V.getPlayers({name:t.name,gameMode:e})].length)}var T=new Eo(vo.acaciaBoat,0);w.subscribe(()=>{fn.runSchedule(()=>{for(let t of To.getPlayers()){if(qt(t)?.typeId!=Ht){M[t.name]&&M[t.name].despawn();continue}Object.keys(M).includes(t?.name)||l(t)=="admin"&&(M[t.name]=new te(t))}},10)});fn.runSchedule(()=>{let t=Object.values(M).map(e=>e.entity.id);for(let e of y.overworld.getEntities({type:de}))t.includes(e.id)||e.triggerEvent("despawn")},100);import{DynamicPropertiesDefinition as So,EntityTypes as Po,world as Ao}from"@minecraft/server";Ao.events.worldInitialize.subscribe(({propertyRegistry:t})=>{y.overworld.runCommandAsync(`tickingarea add ${N.x} ${N.y} ${N.z} ${N.x} ${N.y} ${N.z} db true`);let e=new So;e.defineString("tableName",30),e.defineNumber("index"),t.registerEntityTypeDynamicProperties(e,Po.get(se))});import{system as xo,world as Ro}from"@minecraft/server";import{MinecraftBlockTypes as pn}from"@minecraft/server";var Le=[pn.chest.id,pn.trappedChest.id],W={x:7,y:7,z:7};var Oe=class{constructor(e){this.emptySlotsCount=e.emptySlotsCount,this.size=e.size,this.items=[];for(let n=0;n<this.size;n++)this.items[n]=e.getItem(n)}load(e){for(let n=0;n<e.size;n++)!this.items[n]||e.setItem(n,this.items[n])}};var _e={};xo.runSchedule(()=>{_e={};for(let t of Ro.getPlayers()){if(t.dimension.id!="minecraft:overworld")continue;let e=Te(t.location),n=e.offset(W.x,W.y,W.z),o=e.offset(-W.x,-W.y,-W.z);for(let r of n.blocksBetween(o)){if(r.y<-64)continue;let i=t.dimension.getBlock(r);!i||!Le.includes(i.typeId)||(_e[JSON.stringify(r)]=new Oe(i.getComponent("inventory").container))}}},100);import{system as Bo}from"@minecraft/server";var ye={};w.subscribe(()=>{Bo.run(()=>{for(let t of Object.values(ye))!t.getConfig().enabled||t.enable()})});import{Player as yn}from"@minecraft/server";function gn(t,e,n,o="No Reason",r="Rubedo Auto Mod"){let i={key:e,playerName:t instanceof yn?t.name:t,date:Date.now(),duration:n?ae(n):null,expire:n?ae(n)+Date.now():null,reason:o,by:r};a.bans.set(e,i)}var S=class{constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){e instanceof yn?gn(e,e.id,n,o,r):gn(e,a.ids.get(e),n,o,r)}};import{MessageFormData as No}from"@minecraft/server-ui";var oe=class{constructor(e,n){this.title=e,this.body=n,this.form=new No,e&&this.form.title(e),n&&this.form.body(n),this.triedToShow=0}setButton1(e,n){return this.button1={text:e,callback:n},this.form.button1(e),this}setButton2(e,n){return this.button2={text:e,callback:n},this.form.button2(e),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}n.selection==1&&this.button1?.callback?.(),n.selection==0&&this.button2?.callback?.()})}};function Q(t,e,n,o=()=>{}){new oe("Confirm To Continue",e).setButton1("Confirm",n).setButton2("Never Mind",o).show(t)}var m=class{constructor(e,n,o=0,r){this.data=e;this.type=n;this.depth=o;this.parent=r;e.requires||(e.requires=i=>!0),this.data=e,this.type=n??new F(this.data.name),this.children=[],this.depth=o,this.parent=r,this.callback=null,G.push(this)}argument(e){let n=new m(this.data,e,this.depth+1,this);return this.children.push(n),n}string(e){return this.argument(new ce(e))}int(e){return this.argument(new le(e))}array(e,n){return this.argument(new ue(e,n))}boolean(e){return this.argument(new me(e))}location(e){let n=this.argument(new K(e));return e.endsWith("*")?n:n.location(e+"_y*").location(e+"_z*")}literal(e){let n=new m(e,new F(e.name),this.depth+1,this);return this.children.push(n),n}executes(e){return this.callback=e,this}};var P={"api.name":()=>"Smelly API","api.error.unknown":()=>"An unknown error has occurred.","api.database.error.table_name":(t,e)=>`The display name ${t} is too long for an objective, it can be at most ${e} characters long`,"api.utilities.formatter.error.ms":t=>`${t} is not a string or a number`,"api.Providers.form.invalidType":(t,e)=>`Type ${t} is not a valid type to add a ${e}`,"modules.protections.cps.clickingToFast":()=>"You are clicking to fast! Please click slower!","modules.managers.mute.isMuted":()=>"\xA7cYou've been temporarily muted in chat.","modules.commands.ban.reply":(t,e,n="")=>`\xA7cBanned \xA7f"\xA7a${t}\xA7f" \xA7cfor ${e} Because: "${n??"No reason Provided"}" \xA7aSuccessfully`,"lockdown.kick.message":()=>["\xA7cYou have been kicked!","\xA7aReason: \xA7fServer is currently under LockDown","\xA7fServer will be up soon, Try to join later"],"commands.ban.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry ${n}`,"commands.freeze.list.player":(t,e)=>`- "${t}" Because: ${e}`,"commands.mutes.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry: ${n}`,"commands.lockdown.confirm":"Are you sure you want to lockdown the server, this will kick all active players and all players who try to join who are not admin"};import{ActionFormData as Mo}from"@minecraft/server-ui";var R=class{constructor(e,n){this.title=e,this.body=n,this.form=new Mo,e&&this.form.title(e),n&&this.form.body(n),this.buttons=[],this.triedToShow=0}addButton(e,n=null,o){return this.buttons.push({text:e,iconPath:n,callback:o}),this.form.button(e,n),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}this.buttons[n.selection].callback?.()})}};import{ModalFormData as Do}from"@minecraft/server-ui";var $e=class{constructor(e,n,o){this.form=e,this.player=n,this.callback=o}error(e){new oe("Error",e).setButton1("Return to form",()=>{this.form.show(this.player,this.callback)}).setButton2("Cancel",null).show(this.player)}};var A=class{constructor(e){this.title=e,this.form=new Do,e&&this.form.title(e),this.args=[]}addDropdown(e,n,o){return this.args.push({type:"dropdown",options:n}),this.form.dropdown(e,n,o),this}addSlider(e,n,o,r,i){return this.args.push({type:"slider"}),this.form.slider(e,n,o,r,i),this}addToggle(e,n){return this.args.push({type:"toggle"}),this.form.toggle(e,n),this}addTextField(e,n,o){return this.args.push({type:"textField"}),this.form.textField(e,n,o),this}async show(e,n){for(let o=0;o<200;o++){let r=await this.form.show(e);if(r.cancelationReason!="userBusy"){n(new $e(this,e,n),...r.formValues.map((i,s)=>this.args[s].type=="dropdown"?this.args[s].options[i]:i));return}}return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)")}};function ct(t,e,n,o,r){if(a.bans.get(a.ids.get(e)))return t.reply(`\xA7c${e} is already banned`);t.reply("\xA7aClose chat to confirm"),Q(t.sender,`Are you sure you want to ban ${e}, for ${n??"forever"}`,()=>{new S(e,n,o,t.sender.name),t.reply(P["modules.commands.ban.reply"](e,n,o))})}var Fe=new m({name:"ban",description:"Manage bans",requires:t=>["admin","moderator"].includes(l(t))});Fe.literal({name:"add",description:"Bans a player"}).argument(new f.playerName).executes((t,e)=>{ct(t,e,null,null,t.sender.name)}).argument(new f.duration("duration")).executes((t,e,n)=>{ct(t,e,n,null,t.sender.name)}).string("reason").executes((t,e,n,o)=>{ct(t,e,n,o,t.sender.name)});Fe.literal({name:"remove",description:"un-bans a player"}).argument(new f.playerName("playerName")).executes((t,e)=>{let n=a.bans.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not banned`);a.bans.delete(n.key)?t.reply(`\xA7a${e}\xA7r has been Unbanned!`):t.reply(`\xA7cFailed to un-ban ${e}`)});Fe.literal({name:"list",description:"Lists all bans"}).executes(t=>{let e=a.bans.values();if(e.length==0)return t.sender.tell("\xA7cNo one is banned!");t.sender.tell(`\xA72--- Showing Bans (${e.length}) ---`);for(let n of e)t.sender.tell(P["commands.ban.list.player"](n.playerName,n.reason,n.expire?Z(n.duration):"Forever"))});Fe.literal({name:"test",description:"sdhsd"}).executes(t=>{new R("Manage Bans").addButton("Ban a Player","textures/ui/hammer_r",()=>{new A("Ban a Player").addDropdown("Player Name:",a.ids.keys()).addTextField("Duration","10d, 5h, 2s","null").addTextField("Ban Reason","","No Reason Provided").show(t.sender,(e,n,o,r)=>{console.warn(n,o,r)})}).addButton("Revoke a Ban","textures/ui/hammer_r_disabled",()=>{console.warn("Revoke a player")}).addButton("View Current Bans","textures/ui/store_sort_icon",()=>{console.warn("Revoke a player")}).show(t.sender)});var be=new m({name:"database",description:"Interacts with SA Database",aliases:["db"],requires:t=>l(t)=="admin"});be.literal({name:"get"}).string("table").string("key").executes((t,e,n)=>{try{let o=a[e].get(n);o?t.reply(JSON.stringify(o)):t.reply(`No data could be found for key ${n}`)}catch(o){t.reply(o+o.stack)}});be.literal({name:"set"}).string("table").string("key").string("value").executes((t,e,n,o)=>{try{a[e].set(n,o),t.reply(`Set Key: "${n}", to value: "${o}" on table: "${e}"`)}catch(r){t.reply(r+r.stack)}});be.literal({name:"clear"}).string("table").executes((t,e)=>{try{a[e].clear(),t.reply(`Cleared Table ${e}`)}catch(n){t.reply(n+n.stack)}});be.literal({name:"keys",description:"Returns all keys on a database"}).string("table").executes((t,e)=>{try{let n=a[e].keys();t.reply(`Keys on database: ${e}: ${n}`)}catch(n){t.reply(n+n.stack)}});be.literal({name:"values",description:"Returns all values on a database"}).string("table").executes((t,e)=>{try{let n=a[e].values();t.reply(`Values on database: ${e}: ${JSON.stringify(n,null,2)}`)}catch(n){n instanceof TypeError?t.reply(`No values on database ${e}`):t.reply(n+n.stack)}});new m({name:"ecwipe",description:"Clears a players ender chest",requires:t=>l(t)=="admin"}).argument(new f.player("player")).executes((t,e)=>{for(let n=0;n<27;n++)e.runCommandAsync(`replaceitem entity @s slot.enderchest ${n} air`);t.reply(`\xA7aCleared "${e.name}"'s Ender chest!`)});var ze=class{constructor(e,n="No Reason"){let o={playerName:e.name,key:e.id,reason:n,location:{x:e.location.x,y:e.location.y,z:e.location.z,dimension:e.dimension.id}};a.freezes.set(e.id,o)}};var lt=new m({name:"freeze",description:"Manage Freezes",requires:t=>["admin","moderator"].includes(l(t))});lt.literal({name:"add",description:"Freezes a player"}).argument(new f.player("player")).string("reason").executes((t,e,n)=>{new ze(e,n),t.reply(`\xA7cFroze \xA7f"\xA7a${e.name}\xA7f" Because: "${n}" \xA7aSuccessfully`),t.sender.tell(`\xA7cYou have been frozen by \xA7f"\xA7a${t.sender.name}\xA7f" Because: "${n}"`)});lt.literal({name:"remove",description:"unfreezes a player"}).argument(new f.playerName("playerName")).executes((t,e)=>{let n=a.freezes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not frozen`);a.freezes.delete(n.key),t.reply(`\xA7a${e}\xA7r has been UnFrozen!`)});lt.literal({name:"list",description:"Lists all freezes"}).executes(t=>{let e=a.freezes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is frozen!");t.sender.tell(`\xA72--- Showing Freezes (${e.length}) ---`);for(let n of e)t.sender.tell(P["commands.freeze.list.player"](n.playerName,n.reason))});var mt=class{constructor(e){this.name=e;this.typeName="CommandName"}matches(e){return{success:Boolean(G.find(n=>n.depth==0&&n.data.name==e)),value:e}}fail(e){return`"${e}" is not a valid command`}};function Lo(t,e,n){n.tell(`${v}${t.data.name} ${e.map(o=>o.type.typeName=="literal"?o.data.name:`<${o.type.name}: ${o.type.typeName}>`).join(" ")}`)}function Ve(t,e,n,o){if(!!e.data?.requires(o)&&(e.callback&&Lo(t,e.depth==0?n:n.concat(e),o),e.children.length>0))for(let r of e.children)Ve(t,r,e.depth==0?n:n.concat(e),o)}function hn(t,e,n){t.tell(`\xA72--- Showing help page ${e} of ${n} (${v}help <page: int>) ---`)}function ut(t){return G.filter(e=>e.depth==0&&e.data?.requires(t))}function bn(t){let e=ut(t);return e.length==0?0:Math.ceil(e.length/5)}var kn=new m({name:"help",description:"Provides help/list of commands.",aliases:["?","h"]}).executes(t=>{let e=bn(t.sender),n=ut(t.sender).slice(1*5-5,1*5);hn(t.sender,1,e);for(let o of n)Ve(o,o,[],t.sender)});kn.int("page").executes((t,e)=>{let n=bn(t.sender);e>n&&(e=n);let o=ut(t.sender).slice(e*5-5,e*5);hn(t.sender,e,n);for(let r of o)Ve(r,r,[],t.sender)});kn.argument(new mt("command")).executes((t,e)=>{let n=G.filter(o=>o.depth==0&&o.data.name==e)[0];t.sender.tell(`\xA7e${n.data.name}: ${n.data.aliases?`aliases (${n.data.aliases.join(", ")})`:""}`),t.sender.tell(`\xA7e${n.data.description}`),t.sender.tell("Usage:"),Ve(n,n,[],t.sender)});import{world as In}from"@minecraft/server";new m({name:"lockdown",description:"Toggles the servers lockdown, meaning no one can join",requires:t=>l(t)=="admin"}).executes(t=>{De()?(at(!1),t.sender.tell("\xA7aUnlocked the server!")):(t.reply("\xA7aClose chat to confirm lockdown"),Q(t.sender,P["commands.lockdown.confirm"],()=>{at(!0);for(let e of In.getPlayers())l(e)!="admin"&&j(e,P["lockdown.kick.message"]());In.say("\xA7l\xA7cServer is now LOCKED!")}))});var D=class{static getMuteData(e){return a.mutes.get(e.name)}constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){let i=n?ae(n):null,s={playerName:e.name,date:Date.now(),duration:i,expire:i?i+Date.now():null,reason:o,by:r};a.mutes.set(e.name,s)}};var dt=new m({name:"mute",description:"Manage Mutes",requires:t=>["admin","moderator"].includes(l(t))});dt.literal({name:"add",description:"Mutes a player"}).argument(new f.player("player")).argument(new f.duration("duration")).string("reason").executes((t,e,n,o)=>{new D(e,n,o,t.sender.name),t.reply(`\xA7cMuted \xA7f"\xA7a${e.name}\xA7f" \xA7cfor ${n} Because: "${o}" \xA7aSuccessfully`),e.tell(`\xA7cYou have been muted by \xA7f"${t.sender.name}" \xA7cfor ${n} Because: "${o}"`)});dt.literal({name:"remove",description:"un-mutes a player"}).argument(new f.playerName("playerName")).executes((t,e)=>{let n=a.mutes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not muted!`);a.mutes.delete(n.playerName);try{t.sender.runCommandAsync(`ability "${e}" mute false`)}catch{}t.reply(`\xA7a${e}\xA7r has been UnMuted!`)});dt.literal({name:"list",description:"Lists all freezes"}).executes(t=>{let e=a.mutes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is muted!");t.sender.tell(`\xA72--- Showing Mutes (${e.length}) ---`);for(let n of e)t.sender.tell(P["commands.mutes.list.player"](n.playerName,n.reason,n.expire?Z(n.expire):"Forever"))});import{Location as Oo}from"@minecraft/server";var re=class{static isValid(e){return e.typeId!="minecraft:npc"?!1:je.find(n=>Lt(n,e.location))?!0:!!a.npcs.keys().find(n=>e.id==n)}constructor(e,n){je.push(e);let o=n.spawnEntity("minecraft:npc",e),r={dimension:o.dimension.id,x:o.location.x,y:o.location.y,z:o.location.z};a.npcs.set(o.id,r),wn()}};new m({name:"npc",description:"Spawns a npc at your coordinates",requires:t=>l(t)=="admin"}).executes(t=>{let{x:e,y:n,z:o}=t.sender.location;new re(new Oo(e,n,o),t.sender.dimension),t.reply("Spawned a verified npc at your current location")});import{system as Cn}from"@minecraft/server";async function _o(){let t=Date.now(),e=0;return new Promise(n=>{let o=Cn.runSchedule(()=>{Date.now()-t<1e3?e++:(Cn.clearRunSchedule(o),n(e))})})}new m({name:"ping",description:"Returns the current Ticks Per Second of the servers ping"}).executes(async t=>{let e=await _o();t.reply(`\xA7aCurrent Ticks Per Second: ${e>18?"\xA7f{ \xA7aGood":e>13?"\xA7f{ \xA7eOk":"\xA7f{ \xA7cSevere"} ${e} \xA7f}`)});import{BlockLocation as ke}from"@minecraft/server";var Ie=new m({name:"region",description:"Create a Region",requires:t=>l(t)=="admin"});Ie.literal({name:"add",description:"Adds a new protection region"}).int("from_x").int("from_z").int("to_x").int("to_z").executes((t,e,n,o,r)=>{new p({x:e,z:n},{x:o,z:r},t.sender.dimension.id),t.reply(`Created Region From ${e} -64 ${n} ${o} 320 ${r}`)});Ie.literal({name:"remove",description:"Removes a region at the players current position"}).executes(t=>{let e=new ke(t.sender.location.x,t.sender.location.y,t.sender.location.z);p.removeRegionAtBlockLocation(e,t.sender.dimension.id)?t.reply(`Removed Region at ${e.x} ${e.y} ${e.z}`):t.reply(`Failed to find/remove region at ${e.x} ${e.y} ${e.z}`)});Ie.literal({name:"removeAll",description:"Removes all regions"}).executes(t=>{p.getAllRegions().forEach(e=>e.delete()),t.reply("Removed All regions")});Ie.literal({name:"list",description:"Lists all regions and positions"}).executes(t=>{let e=p.getAllRegions();for(let n of e)t.reply(`Region from ${n.from.x}, ${n.from.z} to ${n.to.x}, ${n.to.z} in dimension ${n.dimensionId}`);if(e.length==0)return t.reply("No regions have been made yet")});var ft=Ie.literal({name:"permission",description:"Handles permissions for regions"});ft.literal({name:"set",description:"Sets a certain permission on the region the player is currently in to a value"}).array("key",["doorsAndSwitches","openContainers","pvp"]).boolean("value").executes((t,e,n)=>{let o=p.blockLocationInRegion(new ke(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!o)return t.reply("You are not in a region");o.changePermission(e,n),t.reply(`Changed permission ${e} to ${n}`)});ft.literal({name:"list",description:"Lists the permissions for the current region"}).executes(t=>{let e=p.blockLocationInRegion(new ke(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!e)return t.reply("You are not in a region");t.reply(`Current region permissions ${JSON.stringify(e.permissions)}`)});var En=ft.literal({name:"entities",description:"Holds the subCommands for adding or removing allowedEntities"});En.literal({name:"add",description:"Adds a entity to the allowed entities list"}).string("entity").executes((t,e)=>{let n=p.blockLocationInRegion(new ke(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntities;o.push(e),n.changePermission("allowedEntities",o),t.reply(`Added entity ${e} to the allowed entities of the region your currently standing in`)});En.literal({name:"remove",description:"Removes a entity from the allowed entities in the region"}).string("entity").executes((t,e)=>{let n=p.blockLocationInRegion(new ke(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntities;if(!o.includes(e))return t.reply(`The entity ${e} is not allowed to enter the region`);o=o.filter(r=>r!=e),n.changePermission("allowedEntities",o),t.reply(`Removed entity ${e} to the allowed entities of the region your currently standing in`)});var pt=(r=>(r[r.member=0]="member",r[r.admin=1]="admin",r[r.moderator=2]="moderator",r[r.builder=3]="builder",r))(pt||{});var $o=t=>isNaN(Number(t))===!1;function Fo(t){return Object.keys(t).filter($o).map(e=>t[e])}var gt=new m({name:"role",description:"Changes the role for a player",requires:t=>l(t)=="admin"||pe(t)});gt.literal({name:"set",description:"Sets the role for a player"}).argument(new f.playerName("playerName")).argument(new f.array("role",Fo(pt))).executes((t,e,n)=>{ne(e,n),t.reply(`Changed role of ${e} to ${n}`)});gt.literal({name:"get",description:"Gets the role of a player"}).argument(new f.playerName("playerName")).executes((t,e)=>{let n=l(e);t.reply(`${e} has role: ${n}`)});var yt=gt.literal({name:"owner",description:"Manages the owner"});yt.literal({name:"get",description:"Gets the owner of the world"}).executes(t=>{let e=st(),n=a.ids.collection(),o=Object.keys(n).find(r=>n[r]===e);t.reply(`\xA7aServer Owner: ${o} (id: ${e})`)});yt.literal({name:"transfer",description:"Transfers the owner of the world",requires:t=>pe(t)}).argument(new f.player).executes((t,e)=>{Q(t.sender,`Are you sure you want to transfer the server ownership to ${e.name}, this action is not reversible!`,()=>{ge(e),t.reply(`\xA7aSet the server Owner to: ${e.name} (id: ${e.id})`)}),t.reply("\xA7aClose chat to confirm")});yt.literal({name:"clear",description:"clear's the owner of the world",requires:t=>pe(t)}).executes(t=>{Q(t.sender,"Are you sure you want to clear the server owner, this action is not reversible!",()=>{ge(null),t.reply('\xA7aCleared the server owner! run "/reload" or reload world to run "/function start" again!')}),t.reply("\xA7aClose chat to confirm")});function vn(t){new R("Manage Banned Items").addButton("Remove a Banned Item",null,()=>{zo(t)}).addButton("Ban an item",null,()=>{Vo(t)}).show(t)}function zo(t){new A("Remove Banned Items").addDropdown("Select item to remove",C("banned_items")).show(t,(e,n)=>{let o=C("banned_items");o=o.filter(r=>r!=n),q("banned_items",o),t.tell(`Removed Banned item "${n}"`)})}function Vo(t){new A("Add Banned Item").addTextField("Item Id","minecraft:string").show(t,(e,n)=>{let o=C("banned_items");if(o.includes(n))return e.error(`\xA7cItem "${n}" is already banned`);o.push(n),q("banned_items",o),t.tell(`Banned the item "${n}"`)})}function Tn(t){new R("Manage Banned Blocks").addButton("Remove a Banned Block",null,()=>{jo(t)}).addButton("Ban an block",null,()=>{Yo(t)}).show(t)}function jo(t){new A("Remove Banned Block").addDropdown("Select block to remove",C("banned_blocks")).show(t,(e,n)=>{let o=C("banned_blocks");o=o.filter(r=>r!=n),q("banned_blocks",o),t.tell(`Removed Banned block "${n}"`)})}function Yo(t){new A("Add Banned Block").addTextField("Block Id","minecraft:barrier").show(t,(e,n)=>{let o=C("banned_blocks");if(o.includes(n))return e.error(`\xA7cBlock "${n}" is already banned`);o.push(n),q("banned_blocks",o),t.tell(`Banned the block "${n}"`)})}function Sn(t){new A("Manage Enchantment Levels").addDropdown("Enchantment to change",Object.keys(Me),0).addTextField("Level (number)","5").show(t,(e,n,o)=>{if(isNaN(o))return e.error(`\xA7c"${o}" is not a number, please enter a value like, "3", "9", etc.`);let r=parseInt(o),i=C("enchantments");i[n]=r,q("enchantments",i),t.tell(`Set max level for ${n} to ${r}`)})}function Pn(t){new A("Manage Appeal Link").addTextField("Appeal Link",Ne).show(t,(e,n)=>{q("appealLink",n),t.tell(`Changed the servers appeal link to ${n}`)})}function An(t){let e=new R("Manage Protections");for(let n of Object.values(ye))e.addButton(n.name,n.iconPath,()=>{Go(n,t)});e.addButton("Back","textures/ui/arrow_dark_left_stretch.png",()=>{Ye(t)}).show(t)}function Go(t,e){let n=t.getConfig(),o=new A(`Manage ${t.name} Protection Config`).addToggle("Enabled",n.enabled),r=[];for(let[i,s]of Object.entries(t.configDefault))r.push(i),typeof s.defaultValue=="boolean"?o.addToggle(s.description,n[i]):typeof s.defaultValue=="number"?o.addSlider(s.description,0,100,1,n[i]):o.addTextField(s.description,null,n[i]);o.show(e,(i,s,...c)=>{s!=n.enabled&&(s&&t.enable(),s||t.disable());let d={enabled:s};for(let[h,E]of Object.keys(t.configDefault).entries())d[E]=c[h];t.setConfig(d),e.tell(`Updated config for ${t.name}!`)})}function Ye(t){new R("Rubedo Settings").addButton("Auto Mod","textures/ui/permissions_op_crown.png",()=>{An(t)}).addButton("Banned items","textures/blocks/sculk_shrieker_top.png",()=>{vn(t)}).addButton("Banned blocks","textures/blocks/barrier.png",()=>{Tn(t)}).addButton("Enchantments","textures/items/book_enchanted.png",()=>{Sn(t)}).addButton("Appeal Link","textures/ui/Feedback.png",()=>{Pn(t)}).show(t)}new m({name:"settings",description:"Opens up the settings menu for the player",requires:t=>["admin","moderator"].includes(l(t))}).executes(t=>{Ye(t.sender),t.sender.tell("\xA7aForm request sent, close chat to continue!")});import{world as xn}from"@minecraft/server";function Rn(t,e){if(t.hasTag("spectator")){if(t.runCommandAsync("gamemode c"),t.triggerEvent("removeSpectator"),t.removeTag("spectator"),!e)return;xn.say({rawtext:[{translate:"multiplayer.player.joined",with:[`\xA7e${t.name}`]}]})}else{if(t.runCommandAsync("gamemode spectator"),t.triggerEvent("addSpectator"),t.addTag("spectator"),!e)return;xn.say({rawtext:[{translate:"multiplayer.player.left",with:[`\xA7e${t.name}`]}]})}}new m({name:"vanish",description:"Toggles Vanish Mode on the sender",requires:t=>l(t)=="admin"}).executes(t=>{Rn(t.sender,!1)}).boolean("say").executes((t,e)=>{Rn(t.sender,e)});var Bn="2.6.7-beta";new m({name:"version",description:"Get Current Rubedo Version",aliases:["v"]}).executes(t=>{t.reply(`Current Rubedo Version: ${Bn}`)});new m({name:"kick",description:"Kicks a player from the game",requires:t=>l(t)=="admin"}).argument(new f.player).string("reason").executes((t,e,n)=>{j(e,[n]),t.reply(`\xA7aKicked ${e.name} from world`)});var O=class{constructor(e){this.data=e,console.warn(`[LOG]: ${e.message}`),a.logs.set(Date.now().toString(),e)}};function ht(t){var e=6e4,n=e*60,o=n*24,r=o*30,i=o*365,s=Date.now()-t;return s<e?Math.round(s/1e3)+" seconds ago":s<n?Math.round(s/e)+" minutes ago":s<o?Math.round(s/n)+" hours ago":s<r?"approximately "+Math.round(s/o)+" days ago":s<i?"approximately "+Math.round(s/r)+" months ago":"approximately "+Math.round(s/i)+" years ago"}var we=new m({name:"log",description:"Manages the log command",requires:t=>l(t)=="admin"});we.literal({name:"add",description:"Adds a new log"}).string("message").executes((t,e)=>{new O({message:e}),t.reply(`\xA7aAdded new log: ${e}`)});we.literal({name:"getAll",description:"Gets all logs sorted in descending"}).int("page").array("order",["ascending","descending"]).executes((t,e,n)=>{let o=Object.entries(a.logs.collection()).sort((i,s)=>n=="ascending"?parseInt(s[0])-parseInt(i[0]):parseInt(i[0])-parseInt(s[0]));if(o.length==0)return t.reply("\xA7cNo Logs have been made!");let r=Math.ceil(o.length/8);e>r&&(e=r),t.reply(`\xA72--- Showing logs page ${e} of ${r} (${v}log getAll <page: int>) ---`);for(let[i,s]of o.slice(e*8-8,e*8))t.reply(`${ht(parseInt(i))}: ${s.message}`)});we.literal({name:"getPlayersLogs",description:"Gets all logs associated with a player"}).argument(new f.playerName).int("page").array("order",["ascending","descending"]).executes((t,e,n,o)=>{let r=Object.entries(a.logs.collection()).filter(s=>s[1].playerName==e).sort((s,c)=>o=="ascending"?parseInt(c[0])-parseInt(s[0]):parseInt(s[0])-parseInt(c[0]));if(r.length==0)return t.reply(`\xA7cNo Logs exists for "${e}"!`);let i=Math.ceil(r.length/8);n>i&&(n=i),t.reply(`\xA72--- Showing logs for "${e}" page ${n} of ${i} ---`);for(let[s,c]of r.slice(n*8-8,n*8))t.reply(`${ht(parseInt(s))}: ${c.message}`)});we.literal({name:"getProtectionLogs",description:"Gets all logs associated with a protection"}).string("protection").int("page").array("order",["ascending","descending"]).executes((t,e,n,o)=>{let r=Object.entries(a.logs.collection()).filter(s=>s[1].protection==e).sort((s,c)=>o=="ascending"?parseInt(c[0])-parseInt(s[0]):parseInt(s[0])-parseInt(c[0]));if(r.length==0)return t.reply(`\xA7cNo Logs exists for protection: "${e}"!`);let i=Math.ceil(r.length/8);n>i&&(n=i),t.reply(`\xA72--- Showing logs for Protection: "${e}" page ${n} of ${i} ---`);for(let[s,c]of r.slice(n*8-8,n*8))t.reply(`${ht(parseInt(s))}: ${c.message}`)});we.literal({name:"clearAll",description:"Clears all logs"}).executes(t=>{a.logs.clear(),t.reply("\xA7aCleared All logs!")});var Uo=new m({name:"teleport",description:"Teleports entities (players, mobs, etc.).",aliases:["tp"],requires:t=>l(t)=="admin"});Uo.argument(new f.player).location("destination").executes((t,e,n)=>{e.addTag("skip-movement-check"),e.teleport(n,e.dimension,0,0),t.reply(`Teleported ${e.name} to ${n.x} ${n.y} ${n.z}`)});import{system as bt,world as qo}from"@minecraft/server";var Ke={};w.subscribe(()=>{bt.runSchedule(()=>{let t=[...qo.getPlayers()];for(let[e,n]of t.entries())for(let o of Object.values(Ke))o.delay!=0&&bt.currentTick-o.lastCall<o.delay||(o.callback(n),e==t.length-1&&(o.lastCall=bt.currentTick))})});var B=class{static subscribe(e,n=0){let o=Object.keys(Ke).length;return Ke[o]={callback:e,delay:n,lastCall:0},o}static unsubscribe(e){delete Ke[e]}};B.subscribe(t=>{try{let e=a.bans.get(t.id);if(!e)return;if(e.expire&&e.expire<Date.now())return a.bans.delete(t.id);j(t,["\xA7cYou have been banned!",`\xA7aReason: \xA7f${e.reason}`,`\xA7fExpiry: \xA7b${e.expire?Z(e.expire-Date.now()):"Forever"}`,`\xA7fAppeal at: \xA7b${C("appealLink")}`],()=>{console.warn(new Error("Failed to kick player")),a.bans.delete(t.id)})}catch(e){console.warn(e+e.stack)}},20);import{Location as Wo}from"@minecraft/server";B.subscribe(t=>{try{let e=a.freezes.get(t.id);if(!e)return t.getComponent("movement").resetToDefaultValue();t.getComponent("movement").setCurrent(0),t.teleport(new Wo(e.location.x,e.location.y,e.location.z),y[e.location.dimension],0,0)}catch{}},200);import{world as Qo}from"@minecraft/server";var kt={};Qo.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(v))for(let e of Object.values(kt))e.callback(t)});var Ge=class{static subscribe(e){let n=Date.now();return kt[n]={callback:e},n}static unsubscribe(e){delete kt[e]}};Ge.subscribe(t=>{let e=D.getMuteData(t.sender);if(!!e){if(e.expire&&e.expire<Date.now())return a.mutes.delete(t.sender.name);t.cancel=!0,t.sender.tell(P["modules.managers.mute.isMuted"]())}});import{BlockLocation as Xo,system as Nn,world as It}from"@minecraft/server";Nn.runSchedule(()=>{Be()},6e3);It.events.beforeItemUseOn.subscribe(t=>{if(["moderator","admin"].includes(l(t.source)))return;let e=p.blockLocationInRegion(t.blockLocation,t.source.dimension.id);if(!e)return;let n=t.source.dimension.getBlock(t.blockLocation);tn.includes(n.typeId)&&e.permissions.doorsAndSwitches||nn.includes(n.typeId)&&e.permissions.openContainers||(t.cancel=!0)});It.events.beforeExplosion.subscribe(t=>{for(let e=0;e<t.impactedBlocks.length;e++){let n=t.impactedBlocks[e];if(p.blockLocationInRegion(n,t.dimension.id))return t.cancel=!0}});It.events.entityCreate.subscribe(async({entity:t})=>{let e=await p.blockLocationInRegionSync(new Xo(t.location.x,t.location.y,t.location.z),t.dimension.id);!e||e.permissions.allowedEntities.includes(t.typeId)||(t.teleport({x:0,y:-64,z:0},t.dimension,0,0),t.kill())});w.subscribe(()=>{Nn.runSchedule(async()=>{for(let t of await p.getAllRegionsSync())for(let e of y[t.dimensionId].getEntities({excludeTypes:t.permissions.allowedEntities}))!t.entityInRegion(e)||(e.teleport({x:0,y:-64,z:0},e.dimension,0,0),e.kill())},100)});B.subscribe(t=>{for(let e of p.getAllRegions())e.entityInRegion(t)?(t.addTag("inRegion"),e.permissions.pvp||t.addTag("region-protected")):(t.removeTag("inRegion"),t.removeTag("region-protected"))},5);import{world as Jo}from"@minecraft/server";Jo.events.playerJoin.subscribe(async({player:t})=>{if(await w.awaitLoad(),De()&&l(t)!="admin")return j(t,P["lockdown.kick.message"]());D.getMuteData(t)&&t.runCommandAsync("ability @s mute true"),a.ids.has(t.name)||a.ids.set(t.name,t.id);let e=L.getPlayersRoleToSet(t.name);e&&ne(t,e)});import{Items as Zo,MinecraftItemTypes as Ce,world as Mn}from"@minecraft/server";var Dn=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44];function er(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,T);continue}o.setItem(r,i.item.itemStack)}for(let[r,i]of[...Mn.getPlayers()].entries()){let s=Dn[r],c=new x(Ce.skull,{nameTag:i.name,data:3});o.setItem(s,c.itemStack),e.slots[s]={item:c,action:d=>{d.PageAction("moderation:see_inventory",{name:i.name})}}}}function tr(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let c=0;c<o.size;c++){let d=e.slots[c];if(!d||!d.item){o.setItem(c,T);continue}o.setItem(c,d.item.itemStack)}let r=[...Mn.getPlayers()].find(c=>c.name==n.name);r||(Object.values(M).find(d=>d.entity.id==t.id).despawn(),r.tell(`"${n.name}" Could not be found, Gui Crashed`));let i=r.getComponent("inventory").container,s=0;for(let c=0;c<i.size;c++){let d=i.getItem(c),h=Dn[s];if(s++,!d){o.setItem(h,T);continue}o.setItem(h,d),e.slots[h]={item:new x(Zo.get(d.typeId),{amount:d.amount,data:d.data},d),action:E=>{c<9?r.runCommandAsync(`replaceitem entity @s slot.hotbar ${c} air`):r.runCommandAsync(`replaceitem entity @s slot.inventory ${c-9} air`),E.GiveAction(),e.slots[h]={item:null,action:so=>{i.addItem(so.getItemAdded())}}}}}}new H("moderation:see",er).setSlots([50],new x(Ce.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("home")}).setSlots([48],new x(Ce.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new H("moderation:see_inventory",tr).setSlots([50],new x(Ce.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new x(Ce.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});import{Player as nr,MinecraftBlockTypes as or}from"@minecraft/server";import{system as Ln,world as On}from"@minecraft/server";var b=class{constructor(e,n,o,r){this.name=e;this.description=n;this.iconPath=o;this.isEnabledByDefault=r;this.name=e,this.description=n,this.iconPath=o,this.configDefault={},this.isEnabled=!1,this.isEnabledByDefault=r,this.events={},this.schedules=[],this.forEachPlayers=[],ye[this.name]=this}setConfigDefault(e){return this.configDefault=e,a.protections.hasSync(this.name).then(n=>{if(n)return;let o={enabled:!0};for(let r of Object.keys(e))o[r]=e[r].defaultValue;a.protections.set(this.name,o)}),this}getConfig(){let e=a.protections.get(this.name);return e||(e={enabled:this.isEnabled}),e}async setConfig(e){return a.protections.set(this.name,e)}triggerChange(e){if(e){this.isEnabled=!0,this.onEnableCallback?.();for(let[n,o]of Object.entries(this.events)){if(o.triggered)continue;let r=On.events[n].subscribe(o.callback);o.triggered=!0,o.callback=r}for(let n of this.forEachPlayers){if(n.key)continue;let o=B.subscribe(n.callback,n.delay);n.key=o}for(let n of this.schedules){if(n.runScheduleId)continue;let o=Ln.runSchedule(n.callback);n.runScheduleId=o}}else{this.isEnabled=!1,this.onDisableCallback?.();for(let[n,o]of Object.entries(this.events))!o.triggered||(On.events[n].unsubscribe(o.callback),o.triggered=!1);for(let n of this.forEachPlayers)!n.key||(B.unsubscribe(n.key),n.key=null);for(let n of this.schedules)!n.runScheduleId||(Ln.clearRunSchedule(n.runScheduleId),n.runScheduleId=null)}}onEnable(e){return this.onEnableCallback=e,this}onDisable(e){return this.onDisableCallback=e,this}subscribe(e,n){return this.events[e]={callback:n,triggered:!1},this}runSchedule(e,n){return this.schedules.push({callback:e,tickInterval:n,runScheduleId:null}),this}forEachPlayer(e,n=0){return this.forEachPlayers.push({callback:e,delay:n,key:null}),this}enable(){this.triggerChange(!0)}disable(){this.triggerChange(!1)}};var rr=["minecraft:command_block_minecart"],He=new b("cbe","Stops CBE","textures/blocks/command_block.png",!0).setConfigDefault({entityCreate:{description:"Adds NPC protection",defaultValue:!0},banSpawnEggs:{description:"If spawn eggs should be banned",defaultValue:!0}});He.subscribe("entityCreate",({entity:t})=>{if(!He.getConfig().entityCreate)return;let n=()=>{try{t.triggerEvent("despawn"),t.kill()}catch{t.kill()}};if(rr.includes(t.typeId)||t.typeId=="minecraft:npc"&&!re.isValid(t))return n()});He.subscribe("beforeItemUseOn",t=>{if(!(t.source instanceof nr)||["admin","moderator"].includes(l(t.source)))return;let e=He.getConfig();if(t.item.typeId.endsWith("spawn_egg")){if(!e.banSpawnEggs||t.source.dimension.getBlock(t.blockLocation).typeId==or.mobSpawner.id)return;t.cancel=!0,t.source.tell("\xA7c[Rubedo]: You cannot place spawnEggs on the floor!"),t.source.playSound("note.bass")}else{if(an.includes(t.item.typeId)){t.cancel=!0;return}if(!C("banned_blocks").includes(t.item.typeId))return;t.cancel=!0,new S(t.source,null,"Placing Banned Blocks")}});var wt=32e4;new b("crasher","Protection against type 1 crasher","textures/ui/servers.png",!0).forEachPlayer(t=>{l(t)!="admin"&&(Math.abs(t.location.x)>wt||Math.abs(t.location.y)>wt||Math.abs(t.location.z)>wt)&&new S(t,null,"Crasher detected")});import{GameMode as sr,world as ar}from"@minecraft/server";import{world as ir}from"@minecraft/server";var k=class{constructor(){this.data=new Map,this.events={playerLeave:ir.events.playerLeave.subscribe(e=>this.data.delete(e.playerName))}}set(e,n){this.data.set(e.name,n)}get(e){return this.data.get(e.name)}has(e){return this.data.has(e.name)}delete(e){this.data.delete(e.name)}clear(){this.data.clear()}playerNames(){return[...this.data.keys()]}includes(e){return this.playerNames().includes(e.name)}};var cr=sr.creative,_n=new k,$n=new b("gamemode","Blocks illegal gamemode","textures/ui/creative_icon.png",!0).setConfigDefault({clearPlayer:{description:"Whether to clear players inventory.",defaultValue:!0},setToSurvival:{description:"If player should be set to survival after being flagged.",defaultValue:!0},banPlayer:{description:"If player should be banned after violation count is met.",defaultValue:!1},violationCount:{description:"The amount of violations before ban.",defaultValue:0}});$n.runSchedule(()=>{let t=$n.getConfig();for(let e of ar.getPlayers({gameMode:cr})){if(["moderator","admin","builder"].includes(l(e)))continue;try{t.setToSurvival&&e.runCommandAsync("gamemode s"),t.clearPlayer&&e.runCommandAsync("clear @s")}catch{}new O({playerName:e.name,protection:"Gamemode",message:`${e.name} has entered into a illegal gamemode!`});let n=(_n.get(e)??0)+1;_n.set(e,n),t.banPlayer&&n>=t.violationCount&&new S(e,null,"Illegal Gamemode")}},20);import{world as lr,Location as mr,system as ur}from"@minecraft/server";var Ct={};lr.events.blockBreak.subscribe(t=>{for(let e of Object.values(Ct))e.callback(new Et(t.block,t.brokenBlockPermutation,t.dimension,t.player))});var Ee=class{static subscribe(e){let n=Date.now();return Ct[n]={callback:e},n}static unsubscribe(e){delete Ct[e]}},Et=class{constructor(e,n,o,r){this.block=e;this.brokenBlockPermutation=n;this.dimension=o;this.player=r;this.block=e,this.brokenBlockPermutation=n,this.dimension=o,this.player=r}set cancel(e){if(this.dimension.getBlock(this.block.location).setPermutation(this.brokenBlockPermutation.clone()),Le.includes(this.brokenBlockPermutation.type.id)){let n=_e[JSON.stringify(this.block.location)];n&&n.load(this.block.getComponent("inventory").container)}ur.run(()=>{[...this.dimension.getEntities({maxDistance:2,type:"minecraft:item",location:new mr(this.block.location.x,this.block.location.y,this.block.location.z)})].forEach(n=>n.kill())})}};var Fn=new k,dr=15,vt=["snow","lush_plants_replaceable","azalea_log_replaceable","minecraft:crop","fertilize_area","plant"],fr=["minecraft:water","minecraft:flowing_water","minecraft:lava","minecraft:flowing_lava","minecraft:bedrock"],zn=new k,Vn=null,jn=new b("nuker","Blocks block breaking too fast","textures/blocks/dirt.png",!0).setConfigDefault({banPlayer:{description:"If the player should be banned once violation count is met",defaultValue:!1},violationCount:{description:"Violations before ban",defaultValue:0}});jn.onEnable(()=>{let t=jn.getConfig();Vn=Ee.subscribe(e=>{if(["moderator","admin"].includes(l(e.player))||e.block.getTags().some(o=>vt.includes(o)))return;let n=Fn.get(e.player);if(Fn.set(e.player,Date.now()),!!n){if(!fr.includes(e.block.typeId)){if(n<Date.now()-dr)return;let o=(zn.get(e.player)??0)+1;zn.set(e.player,o),t.banPlayer&&o>=t.violationCount&&new S(e.player,null,"Using Nuker")}e.cancel=!0}})}).onDisable(()=>{Ee.unsubscribe(Vn)});var Yn=new k,Kn=new k,Gn=new b("spam","Blocks spam in chat","textures/ui/mute_on.png",!0).setConfigDefault({permMutePlayer:{description:"If player should be permanently muted once violation count is met.",defaultValue:!1},violationCount:{description:"Violation count before permanent mute",defaultValue:0},repeatedMessages:{description:"Blocks repeated messages",defaultValue:!0},zalgo:{description:"Blocks zalgo",defaultValue:!0}});Gn.subscribe("beforeChat",t=>{try{if(t.message.startsWith(v)||["admin","moderator"].includes(l(t.sender)))return;let e=Gn.getConfig(),n=()=>{let o=(Kn.get(t.sender)??0)+1;Kn.set(t.sender,o),e.permMutePlayer&&o>=e.violationCount&&new D(t.sender,null,"Spamming")};if(e.repeatedMessages&&Yn.get(t.sender)==t.message)return t.cancel=!0,n(),t.sender.tell("\xA7cRepeated message detected!");if(e.zalgo&&/%CC%/g.test(encodeURIComponent(t.message)))return t.cancel=!0,n(),t.sender.tell("\xA7cYou message contains some type of zalgo and cannot be sent!");Yn.set(t.sender,t.message)}catch(e){console.warn(e+e.stack)}});var Hn=new k,pr=new b("unobtainable","Blocks unobtainable items","textures/blocks/end_portal.png",!0).setConfigDefault({clearItem:{description:"If the possessed item should be cleared from there inventory",defaultValue:!0},banPlayer:{description:"If the player should be banned once hit violation count.",defaultValue:!0},violationCount:{description:"The amount of times this player can posses a banned item before ban.",defaultValue:3}}).forEachPlayer(t=>{if(l(t)=="admin")return;let e=new Set(C("banned_items")),n=t.getComponent("inventory").container;for(let o=0;o<n.size;o++){let r=n.getItem(o);if(!r)continue;if(e.has(r.typeId))return Ue(t,o);if(rn.includes(r.typeId))return new O({playerName:t.name,message:`${t.name} Has obtained a Forbidden item: ${r.typeId}`,protection:"unobtainable"}),n.setItem(o,T);let i=new Set;for(let s of r.getComponent("enchantments").enchantments){let c=un(s);if(s.level>c||s.level<1||i.has(s.type.id))return Ue(t,o);i.add(s.type.id)}}});function Ue(t,e){let n=t.getComponent("inventory").container,o=n.getItem(e),r=pr.getConfig();if(r.clearItem&&n.setItem(e,T),new O({playerName:t.name,message:`${t.name} Has obtained a unobtainable item: ${o.typeId}`,protection:"unobtainable"}),!r.banPlayer)return;let i=(Hn.get(t)??0)+1;Hn.set(t,i),!(i<r.violationCount)&&new S(t,null,"Possession of Unobtainable item")}import{ItemStack as gr,MinecraftBlockTypes as I,MinecraftEntityTypes as yr,MinecraftItemTypes as _,Player as hr}from"@minecraft/server";var br=[I.chest.id,I.trappedChest.id,I.barrel.id,I.dispenser.id,I.dropper.id,I.furnace.id,I.litFurnace.id,I.blastFurnace.id,I.litBlastFurnace.id,I.smoker.id,I.litSmoker.id,I.hopper.id,I.beehive.id,I.beeNest.id,I.mobSpawner.id],kr=[_.chestBoat.id,_.oakChestBoat.id,_.birchChestBoat.id,_.acaciaChestBoat.id,_.jungleChestBoat.id,_.spruceChestBoat.id,_.darkOakChestBoat.id,_.mangroveChestBoat.id];new b("nbt","Blocks illegal nbt on items","textures/ui/icon_random.png",!0).subscribe("blockPlace",async({block:t})=>{if(!!br.includes(t.typeId))if([I.chest.id,I.trappedChest.id].includes(t.typeId)){let e=t.getComponent("inventory").container;for(let n=0;n<e.size;n++)e.setItem(n,new gr(_.acaciaBoat,0))}else{let e=t.permutation;await t.dimension.runCommandAsync(`setblock ${t.x} ${t.y} ${t.z} ${t.typeId}`),t.setPermutation(e)}}).subscribe("beforeItemUseOn",t=>{t.source instanceof hr&&(!kr.includes(t.item.typeId)||(t.cancel=!0,t.source.dimension.spawnEntity(yr.chestBoat.id,t.blockLocation.above()),dn(t.source)!="creative"&&t.source.getComponent("inventory").container.setItem(t.source.selectedSlot,T)))});import{MinecraftBlockTypes as Er,MinecraftEffectTypes as vr,MinecraftItemTypes as xt,Player as qe,system as Rt}from"@minecraft/server";import{system as Un,world as Ir}from"@minecraft/server";var Tt={};function wr(t,e){return!(t.x!=e.x||t.y!=e.y||t.z!=e.z)}var St=new k;Un.runSchedule(()=>{let t=(e,n)=>{for(let o of Object.values(Tt))o.callback(e,n)};for(let e of Ir.getPlayers()){let n=St.get(e);n&&wr(e.location,n.location)||(St.set(e,{location:e.location,dimension:e.dimension,currentTick:Un.currentTick}),n&&t(e,n))}});var $=class{static subscribe(e){let n=Date.now();return Tt[n]={callback:e},n}static unsubscribe(e){delete Tt[e]}static delete(e){St.delete(e)}};var qn={walk:{velocity:.17,distance:.23},run:{velocity:.19,distance:.35}},Wn=.056,Qn=10,Xn=["gliding","riding"],Jn=32767.001953125,Zn=60;var eo=new k,At=new k;function Tr(t,e){return Math.hypot(e.x-t.x,e.z-t.z)}function Sr(t){return(t.getEffect(vr.speed)?.amplifier??0)*Wn}function Pr(t,e,n){let o=Sr(n),r=Rt.currentTick-e,i=qn.run.distance*r+.8;return t>o+i}function Pt(t,e){let n=(eo.get(t)??0)+1;eo.set(t,n),$.delete(t),!(n<3)&&t.teleport(e.location,e.dimension,t.rotation.x,t.rotation.y)}function Ar(t){let e=t.dimension.getBlock(Te(t.location));if(!e.getTags().some(n=>vt.includes(n))&&!e.type.id.endsWith("grass")&&!e.type.id.endsWith("water")&&!e.type.id.endsWith("lava")&&!e.type.id.endsWith("portal")&&!e.type.id.endsWith("gateway")&&e.typeId!=Er.air.id&&!e.type.canBeWaterlogged)return!0}var to=null,ie=new b("movement","Blocks illegal movements on players","textures/ui/move.png",!0).setConfigDefault({tpCheck:{description:"If teleports should be flagged",defaultValue:!0}});ie.onEnable(()=>{let t=ie.getConfig();to=$.subscribe((e,n)=>{if(l(e)=="admin"||e.dimension.id!=n.dimension.id||e.getTags().some(r=>Xn.includes(r)))return;let o=Tr(e.location,n.location);if(e.hasTag("skip-movement-check"))return e.removeTag("skip-movement-check");if(n.location.y!=Jn&&!At.has(e)){if(Ar(e))return Pt(e,n);if(o>Qn){if(!t.tpCheck)return;Pt(e,n)}else{if(!Pr(o,n.currentTick,e))return;Pt(e,n)}}})}).onDisable(()=>{$.unsubscribe(to)});ie.subscribe("dataDrivenEntityTriggerEvent",t=>{if(!(t.entity instanceof qe)||t.id!="on_death")return;let e=t.entity;Rt.run(()=>{$.delete(e)})});ie.subscribe("projectileHit",({projectile:t,source:e})=>{t.typeId==xt.enderPearl.id&&e instanceof qe&&$.delete(e)});ie.subscribe("itemCompleteCharge",({itemStack:t,source:e})=>{t.typeId==xt.chorusFruit.id&&e instanceof qe&&$.delete(e)});ie.subscribe("itemReleaseCharge",({itemStack:t,source:e})=>{t.typeId==xt.trident.id&&e instanceof qe&&(At.set(e,!0),Rt.runSchedule(()=>{At.delete(e)},Zn))});import{MinecraftEffectTypes as xr,Player as Rr,world as no}from"@minecraft/server";var Br=no.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{if(!(t.entity instanceof Rr)||t.id!="rubedo:becomeAdmin")return;t.entity.removeTag("CHECK_PACK");let e=mn();if(e)return t.entity.playSound("note.bass"),t.entity.tell(`\xA7cFailed to give server owner: "${e}" is already owner!`),no.events.beforeDataDrivenEntityTriggerEvent.unsubscribe(Br);ne(t.entity,"admin"),ge(t.entity),t.entity.addEffect(xr.blindness,3,255,!0),t.entity.tell('\xA7aYou have now been set as the "owner" of this server. The command "/function start" will not do anything anymore, type "-help" for more information!')});import{DynamicPropertiesDefinition as ro,MinecraftEntityTypes as Nr,world as io}from"@minecraft/server";var oo=[];io.events.worldInitialize.subscribe(({propertyRegistry:t})=>{let e=new ro;e.defineString("role",30),t.registerEntityTypeDynamicProperties(e,Nr.player);let n=new ro;n.defineString("worldsOwner",100),n.defineBoolean("isLockDown"),t.registerWorldDynamicProperties(n);for(let o of oo)io.scoreboard.addObjective(o.objective,o.displayName??"")});var je=[];function wn(){je=[]}console.warn("----- Importing Plugins -----");Mr.events.beforeWatchdogTerminate.subscribe(t=>{t.cancel=!0,console.warn(`WATCHDOG TRIED TO CRASH = ${t.terminateReason}`)});
//# sourceMappingURL=index.js.map
