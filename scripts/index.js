import{system as fr}from"@minecraft/server";import{world as oo}from"@minecraft/server";var I="-";import{world as to}from"@minecraft/server";import{ItemStack as Zn,MinecraftItemTypes as eo}from"@minecraft/server";import{BlockLocation as Qn}from"@minecraft/server";var vt=32e3,St=2e6,ne="database:database",T=new Qn(0,-64,0),Pt=128;import{BlockLocation as je,MinecraftDimensionTypes as U,system as At,world as q}from"@minecraft/server";var y={overworld:q.getDimension(U.overworld),nether:q.getDimension(U.nether),theEnd:q.getDimension(U.theEnd),"minecraft:overworld":q.getDimension(U.overworld),"minecraft:nether":q.getDimension(U.nether),"minecraft:the_end":q.getDimension(U.theEnd)};var xt={y:317098e-16,w:6048e5,d:864e5,h:36e5,m:6e4,s:1e3,ms:1};function oe(t){let e=t.split(","),n=0;for(let o of e){let r=parseInt(o.match(/\d+/)[0]),i=o.match(/[a-zA-Z]+/)[0];if(!xt[i])throw new Error(`Invalid duration unit: ${i}`);n+=xt[i]*r}return n}function W(t){return new Date(t).toString()}function we(t){return new je(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}function Rt(t){return new Promise(e=>{let n=At.runSchedule(()=>{e(),At.clearRunSchedule(n)},t)})}function Mt(t,e){return t instanceof je||e instanceof je?~~t.x===~~e.x&&~~t.y===~~e.y&&~~t.z===~~e.z:t.x===e.x&&t.y===e.y&&t.z===e.z}function Xn(t,e){return[t.x,e.x]=[Math.min(t.x,e.x),Math.max(t.x,e.x)],[t.y,e.y]=[Math.min(t.y,e.y),Math.max(t.y,e.y)],[t.z,e.z]=[Math.min(t.z,e.z),Math.max(t.z,e.z)],[t,e]}function Ce(t,e,n){let[o,r]=Xn(e,n),{x:i,y:a,z:l}=t;return i>=o.x&&i<=r.x&&a>=o.y&&a<=r.y&&l>=o.z&&l<=r.z}function Nt(t,e,n){let o=[];for(let i=0;i<t.length;i+=e)o.push(t.slice(i,i+e));let r=[];for(let i of o)r.push(Array.from({length:Math.ceil(i.length/n)},(a,l)=>i.slice(l*n,(l+1)*n)));return r}import{system as Jn,world as Bt}from"@minecraft/server";var re={},Ye=!1;function Lt(){Ye=!0;for(let[t,e]of Object.entries(re))e(),delete re[t]}Jn.run(async()=>{try{await y.overworld.runCommandAsync("testfor @a"),Lt()}catch{let e=Bt.events.playerSpawn.subscribe(()=>{Lt(),Bt.events.playerSpawn.unsubscribe(e)})}});var C=class{static async awaitLoad(){if(!Ye)return new Promise(e=>{C.subscribe(e)})}static subscribe(e){let n=Object.keys(re).length;return Ye?(e(),n):(re[n]=e,n)}static unsubscribe(e){delete re[e]}};var h=class{constructor(e){this.tableName=e;this.tableName=e,this.MEMORY=null,this.QUEUE=[],this.onLoadCallback=null,C.subscribe(async()=>{let n=await this.initData();this.onLoadCallback(n),this.QUEUE.forEach(o=>o())})}static createTableEntity(e,n){let o=y.overworld.spawnEntity(ne,T);return o.setDynamicProperty("tableName",e),o.nameTag=`\xA7aDatabase Table: ${e}\xA7r`,n&&o.setDynamicProperty("index",n),o}static getTableEntities(e){return y.overworld.getEntitiesAtBlockLocation(T).filter(n=>n.typeId==ne&&n.getDynamicProperty("tableName")==e)}static despawnTableEntities(){return y.overworld.getEntitiesAtBlockLocation(T).map(e=>e.triggerEvent("despawn"))}async addQueueTask(){return new Promise(e=>{this.QUEUE.push(e)})}async saveData(){this.MEMORY||await this.addQueueTask();let e=h.getTableEntities(this.tableName),n=Nt(JSON.stringify(this.MEMORY),vt,St),o=Math.ceil(n.length/Pt)-e.length;if(o>0)for(let a=0;a<o;a++)e.push(h.createTableEntity(this.tableName));let r=0,i=0;for(;r<n.length;){let a=e[i];if(!a)continue;let l=a.getComponent("inventory").container;l.clearAll();for(let d=0;d<l.size&&r<n.length;d++){let g=n[r],b=new Zn(eo.acaciaBoat);b.setLore(g),l.setItem(d,b),r++}a.setDynamicProperty("index",i),i++}e.slice(i).forEach(a=>a?.triggerEvent("despawn"))}async initData(){let e=h.getTableEntities(this.tableName).sort((o,r)=>o.getDynamicProperty("index")-r.getDynamicProperty("index"));e.length==0&&console.warn(`[Database-Warning]: No data found for table ${this.tableName}!`);let n=[];for(let o of e){let r=o.getComponent("inventory").container;for(let i=0;i<r.size;i++){let a=r.getItem(i);a&&n.push(...a.getLore())}}return this.MEMORY=JSON.parse(n.join("")||"{}"),console.warn(`table ${this.tableName} memor ${this.MEMORY}`),this.MEMORY}async onLoad(e){this.onLoadCallback=e}async set(e,n){return this.MEMORY[e]=n,this.saveData()}get(e){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `getAsync` instead!");return this.MEMORY[e]}async getSync(e){return this.MEMORY?this.get(e):(await this.addQueueTask(),this.MEMORY[e])}keys(){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `keysSync` instead!");return Object.keys(this.MEMORY)}async keysSync(){return this.MEMORY?this.keys():(await this.addQueueTask(),Object.keys(this.MEMORY))}values(){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `valuesSync` instead!");return Object.values(this.MEMORY)}async valuesSync(){return this.MEMORY?this.values():(await this.addQueueTask(),Object.values(this.MEMORY))}has(e){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `hasSync` instead!");return Object.keys(this.MEMORY).includes(e)}async hasSync(e){return this.MEMORY?this.has(e):(await this.addQueueTask(),Object.keys(this.MEMORY).includes(e))}collection(){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `collectionSync` instead!");return this.MEMORY}async collectionSync(){return this.MEMORY?this.collection():(await this.addQueueTask(),this.MEMORY)}async delete(e){let n=delete this.MEMORY[e];return await this.saveData(),n}async clear(){return this.MEMORY={},await this.saveData()}};var s={config:new h("config"),freezes:new h("freezes"),mutes:new h("mutes"),bans:new h("bans"),regions:new h("regions"),roles:new h("roles"),tasks:new h("tasks"),npcs:new h("npcs"),ids:new h("ids"),logs:new h("logs"),protections:new h("protections")};function Dt(t){return[...to.getPlayers()].find(e=>e.name===t)}var D=class{constructor(e="literal"){this.name=e;this.typeName="literal";this.name=e}matches(e){return{success:this.name==e}}fail(e){return`${e} should be ${this.name}!`}},ie=class{constructor(e="string"){this.name=e;this.typeName="string";this.name=e}matches(e){return{success:e&&e!="",value:e}}fail(e){return"Value must be of type string!"}},se=class{constructor(e="integer"){this.name=e;this.typeName="int";this.name=e}matches(e){return{success:!isNaN(e),value:parseInt(e)}}fail(e){return"Value must be valid number!"}},Ge=class{constructor(e="float"){this.name=e;this.typeName="float";this.name=e}matches(e){return{success:Boolean(e?.match(/^\d+\.\d+$/)?.[0]),value:parseInt(e)}}fail(e){return"Value must be valid float!"}},F=class{constructor(e="location"){this.name=e;this.typeName="location";this.name=e}matches(e){return{success:/^([~^]{0,1}(-\d)?(\d*)?(\.(\d+))?)$/.test(e),value:e}}fail(e){return"Value needs to be a valid number, value can include: [~,^]"}},ae=class{constructor(e="boolean"){this.name=e;this.typeName="boolean";this.name=e}matches(e){return{success:Boolean(e?.match(/^(true|false)$/)?.[0]),value:e=="true"}}fail(e){return`"${e}" can be either "true" or "false"`}},Ke=class{constructor(e="player"){this.name=e;this.typeName="Player";this.name=e}matches(e){return{success:!!Dt(e),value:Dt(e)}}fail(e){return`player: "${e}", is not in this world`}},He=class{constructor(e="target"){this.name=e;this.typeName="Target";this.name=e}matches(e){return{success:Boolean(e?.match(/^(@.|"[\s\S]+")$/)?.[0]),value:e}}fail(e){return`${e} is not a valid target`}},le=class{constructor(e="array",n){this.name=e;this.types=n;this.typeName="string";this.name=e,this.types=n,this.typeName=n.join(" | ").replace(/(.{25})..+/,"$1...")}matches(e){return{success:this.types.includes(e),value:e}}fail(e){return`"${e}" must be one of these values: ${this.types.join(" | ")}`}},Ue=class{constructor(e){this.name=e;this.typeName="Duration"}matches(e){return{success:/^(\d+[hdysmw],?)+$/.test(e),value:e}}fail(e){return`"${e}" must be a value like "10d" or "3s" the first part is the length second is unit`}},qe=class{constructor(e="playerName"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!s.ids.get(e),value:e}}fail(e){return`player: "${e}" has never played this world before! Tip: if the name has spaces in it use quotes around name!`}},p={string:ie,int:se,float:Ge,location:F,boolean:ae,player:Ke,target:He,array:le,duration:Ue,playerName:qe};var Ee=class{constructor(e){this.data=e,this.sender=e.sender}reply(e){this.sender.tell(e)}};function Ot(t,e){try{return t.slice(e.length).trim().match(/"[^"]+"|[^\s]+/g).map(n=>n.replace(/"(.+)"/,"$1").toString())}catch{return[]}}function _t(t,e){t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.unknown",with:[`${e}`]}]})}function We(t,e){t.tell({rawtext:[{text:e.data.invalidPermission?e.data.invalidPermission:`\xA7cYou do not have permission to use "${e.data.name}"`}]})}function $t(t,e,n,o,r){if(t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.syntax",with:[`${I}${e.data.name} ${o.slice(0,r).join(" ")}`,o[r]??" ",o.slice(r+1).join(" ")]}]}),n.children.length>1||!o[r]){let i=n.children.map(a=>a.type instanceof D?a.type.name:a.type?.typeName);t.tell(`\xA7c"${o[r]??"undefined"}" is not valid! Argument "${[...new Set(n.children.map(a=>a.type.name))][0]}" can be typeof: "${i.join('", "')}"`)}else t.tell(`\xA7c${n.children[0]?.type?.fail(o[r])}`)}function no([t,e,n],{location:o,viewDirection:r}){if(!t||!e||!t)return null;let i=[o.x,o.y,o.z],a=[r.x,r.y,r.z],l=[t,e,n].map(g=>{let b=parseFloat(g);return isNaN(b)?0:b}),d=[t,e,n].map((g,b)=>g.includes("~")?l[b]+i[b]:g.includes("^")?l[b]+a[b]:l[b]);return{x:d[0],y:d[1],z:d[2]}}function Ft(t,e,n,o){let r=e[e.length-1]??o,i=[];for(let[a,l]of e.entries())if(!l.type.name.endsWith("*")){if(l.type instanceof F){i.push(no([t[a],t[a+1],t[a+2]],n.sender));continue}l.type instanceof D||i.push(l.type.matches(t[a]).value??t[a])}r.callback(new Ee(n),...i)}var z=[];oo.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(I))return;t.cancel=!0;let e=Ot(t.message,I),n=z.find(l=>l.depth==0&&(l.data.name==e[0]||l.data?.aliases?.includes(e[0]))),o={message:t.message,sendToTargets:t.sendToTargets,sender:t.sender,targets:t.targets};if(!n)return _t(t.sender,e[0]);if(!n.data?.requires(t.sender))return We(o.sender,n);e.shift();let r=[],i=(l,d)=>{if(l.children.length>0){let g=l.children.find(b=>b.type.matches(e[d]).success);return!g&&!e[d]&&l.callback?void 0:g?g.data?.requires(o.sender)?(r.push(g),i(g,d+1)):(We(o.sender,g),"fail"):($t(o.sender,n,l,e,d),"fail")}};i(n,0)!="fail"&&Ft(e,r,o,n)});import{ItemStack as fo,MinecraftItemTypes as go,system as nn,world as yo}from"@minecraft/server";var zt="rubedo:gui",ce="rubedo:inventory";import{system as Kt}from"@minecraft/server";import{system as ro}from"@minecraft/server";var Qe={},Vt={},O={};function io(t,e,n){if(e.length!=n.length)return[];let o=[];for(let r=0;r<n.length;r++){if(e[r]?.item?.amount<n[r]?.item?.amount||e[r]?.item?.amount>n[r]?.item?.amount&&e[r]?.item?.amount!=0){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"fluctuation"};o.push(i),O[t.id]=i;continue}if(n[r].uid!=e[r].uid)if(e[r]?.item&&n[r]?.item){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"swap"};o.push(i),O[t.id]=i}else if(n[r]?.item){if(n[r]?.item)if(O[t.id]?.changeType=="delete"&&O[t.id]?.uid==n[r].uid){let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"move"};o.push(i),O[t.id]=i;continue}else{let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"put"};o.push(i),O[t.id]=i}}else{let i={slot:r,uid:e[r].uid,item:e[r].item,changeType:"delete"};o.push(i),O[t.id]=i}}return o}function so(t){if(!t)return"";let e=[];return e.push(t.typeId),e.push(t.nameTag),e.push(t.data),e.push(t.getLore().join("")),e.join("")}function ao(t){let e=[];for(let n=0;n<t.size;n++){let o=t.getItem(n);e[n]={uid:so(o),item:o}}return e}ro.runSchedule(()=>{for(let t of Object.values(Qe))for(let e of y.overworld.getEntities(t.entities)){let n=ao(e.getComponent("inventory").container),o=io(e,Vt[e.id]??n,n);if(Vt[e.id]=n,o.length!=0){if(e.hasTag("skipCheck")){e.removeTag("skipCheck"),delete O[e.id];continue}for(let r of o)t.callback(e,r)}}},5);var me=class{static subscribe(e,n){let o=Date.now();return Qe[o]={callback:n,entities:e},o}static unsubscribe(e){delete Qe[e]}};import{Location as lo}from"@minecraft/server";var P={},Q={};function jt(t){return t.getComponent("minecraft:inventory").container.getItem(t.selectedSlot)}async function Yt(t,e){try{let n=t.getComponent("minecraft:inventory").container,o=[];for(let r=0;r<n.size;r++){let i=n.getItem(r);!i||i?.typeId==e?.typeId&&(o.push({slot:r,item:i}),n.setItem,r<9?t.runCommandAsync(`replaceitem entity @s slot.hotbar ${r} air`):t.runCommandAsync(`replaceitem entity @s slot.inventory ${r-9} air`))}await t.runCommandAsync(`clear @s ${e?.typeId} ${e.data} ${e.amount}`);for(let r of o)n.setItem(r.slot,r.item)}catch{[...t.dimension.getEntities({type:"minecraft:item",location:new lo(t.location.x,t.location.y,t.location.z),maxDistance:2,closest:1})].forEach(o=>o.kill())}}function Gt(t,e){return t.getComponent("minecraft:inventory").container.getItem(e)}var Te=class{constructor(e,n,o){this.gui=e,this.slot=n,this.change=o}message(e){this.gui.player.tell(e)}getItemAdded(){return this.slot.item?null:this.gui.entity.getComponent("minecraft:inventory").container.getItem(this.change.slot)}GiveAction(e=this.slot.item.itemStack){this.gui.player.getComponent("minecraft:inventory").container.addItem(e)}TakeAction(e=null){this.gui.player.getComponent("minecraft:inventory").container.addItem(this.slot.item.itemStack),this.gui.page.slots[this.change.slot]=null,e&&e.delete(this.slot.item.components.dbKey)}PageAction(e,n){this.gui.setPage(e,n)}CloseAction(){this.gui.despawn()}SetAction(){this.gui.entity.getComponent("minecraft:inventory").container.setItem(this.change.slot,this.slot.item.itemStack)}async FormAction(e){return this.CloseAction(),await Rt(5),await e.show(this.gui.player)}};var X=class{static spawnEntity(e){try{return e.dimension.spawnEntity(ce,e.headLocation)}catch{return null}}constructor(e){this.player=e,this.entity=X.spawnEntity(e),this.entity&&(this.hasChestOpen=!1,this.setPage("home")),this.runScheduleId=Kt.runSchedule(()=>{if(!this.entity)return this.despawn();if(this.player.getComponent("mark_variant").value==1)this.hasChestOpen||(this.slotChangeEvent=me.subscribe({type:ce},(n,o)=>{n.id==this.entity.id&&this.onSlotChange(o)})),this.hasChestOpen=!0;else try{this.entity.teleport(this.player.headLocation,this.player.dimension,this.player.rotation.x,this.player.rotation.y,!0)}catch{this.despawn()}},5)}setPage(e,n){let o=this.entity.getComponent("inventory").container;for(let i=0;i<o.size;i++)o.setItem(i,M);if(!Object.keys(Q).includes(e))throw new Error(`pageId ${e} does not exist!`);let r=Q[e];this.page=r,r.fillType(this.entity,r,n),this.entity.nameTag="size:54"}onSlotChange(e){let n=this.page.slots[e.slot];if(!n)this.entity.getComponent("inventory").container.setItem(e.slot,M);else if(e.changeType=="delete"){if(n.item&&Yt(this.player,e.item),!n.item&&!Gt(this.entity,e.slot))return;n.action(new Te(this,n,e))}}despawn(){try{this.entity?.triggerEvent("despawn")}catch{}try{delete P[this.player.name]}catch{}this.runScheduleId&&Kt.clearRunSchedule(this.runScheduleId),this.slotChangeEvent&&me.unsubscribe(this.slotChangeEvent)}};import{ItemStack as co}from"@minecraft/server";var E=class{constructor(e,n={},o){this.itemType=e,this.components=n,this.setItemStack=o}get itemStack(){if(this.setItemStack)return this.setItemStack;let e=new co(this.itemType);if(this.components){e.amount=this.components?.amount??1,e.data=this.components?.data??0,e.nameTag=this.components?.nameTag,e.setLore(this.components?.loreList??[]);let n=e.getComponent("enchantments").enchantments;for(let o of this.components?.enchantments??[])n.addEnchantment(o);e.getComponent("enchantments").enchantments=n}return e}};function Ht(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,M);continue}o.setItem(r,i.item.itemStack)}}var V=class{constructor(e,n=Ht){if(Object.keys(Q).includes(e))throw new Error(`Page: ${e}, Already exists!`);this.id=e,this.fillType=n,this.slots=[],Q[e]=this}setSlots(e,n,o){let r=n?{item:n,action:o}:null;for(let i of e)this.slots[i]=r;return this}};import{MinecraftItemTypes as Ut}from"@minecraft/server";var Bi=new V("home").setSlots([22],new E(Ut.enderChest,{nameTag:"\xA7l\xA7bInventory Viewer"}),t=>{t.PageAction("moderation:see")}).setSlots([54],new E(Ut.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});import{world as Y,Player as uo,BlockLocation as en,MinecraftBlockTypes as po,GameMode as Zi}from"@minecraft/server";import{BlockLocation as Xt,MinecraftBlockTypes as mo}from"@minecraft/server";var qt={doorsAndSwitches:!0,openContainers:!0,pvp:!1,allowedEntities:["minecraft:player","minecraft:npc","minecraft:item","rubedo:inventory","rubedo:database"]},Wt=["minecraft:acacia_door","minecraft:acacia_trapdoor","minecraft:acacia_button","minecraft:birch_door","minecraft:birch_trapdoor","minecraft:birch_button","minecraft:crimson_door","minecraft:crimson_trapdoor","minecraft:crimson_button","minecraft:dark_oak_door","minecraft:dark_oak_trapdoor","minecraft:dark_oak_button","minecraft:jungle_door","minecraft:jungle_trapdoor","minecraft:jungle_button","minecraft:mangrove_door","minecraft:mangrove_trapdoor","minecraft:mangrove_button","minecraft:spruce_door","minecraft:spruce_trapdoor","minecraft:spruce_button","minecraft:warped_door","minecraft:warped_trapdoor","minecraft:warped_button","minecraft:wooden_door","minecraft:wooden_button","minecraft:trapdoor","minecraft:iron_door","minecraft:iron_trapdoor","minecraft:polished_blackstone_button","minecraft:lever"],Qt=["minecraft:chest","minecraft:ender_chest","minecraft:barrel","minecraft:trapped_chest","minecraft:dispenser","minecraft:dropper","minecraft:furnace","minecraft:blast_furnace","minecraft:lit_furnace","minecraft:lit_blast_furnace","minecraft:hopper","minecraft:shulker_box","minecraft:undyed_shulker_box","minecraft:lit_smoker","minecraft:smoker"];var j=[],ve=!1,Xe=-64,Je=320,f=class{static async getAllRegionsSync(){if(ve)return j;let e=(await s.regions.valuesSync()).map(n=>new f(n.from,n.to,n.dimensionId,n.permissions,n.key));return e.forEach(n=>{j.push(n)}),ve=!0,e}static getAllRegions(){if(ve)return j;let e=s.regions.values().map(n=>new f(n.from,n.to,n.dimensionId,n.permissions,n.key));return e.forEach(n=>{j.push(n)}),ve=!0,e}static blockLocationInRegion(e,n){return this.getAllRegions().find(o=>o.dimensionId==n&&Ce(e,{x:o.from.x,y:Xe,z:o.from.z},{x:o.to.x,y:Je,z:o.to.z}))}static async blockLocationInRegionSync(e,n){return(await this.getAllRegionsSync()).find(o=>o.dimensionId==n&&Ce(e,{x:o.from.x,y:Xe,z:o.from.z},{x:o.to.x,y:Je,z:o.to.z}))}static async removeRegionAtBlockLocation(e,n){let o=this.blockLocationInRegion(e,n);return o?s.regions.delete(o.key):!1}constructor(e,n,o,r,i){this.from=e,this.to=n,this.dimensionId=o,this.permissions=r??qt,this.key=i||Date.now().toString(),i||this.update().then(()=>{Se(),j.push(this)})}async update(){return s.regions.set(this.key,{key:this.key,from:this.from,dimensionId:this.dimensionId,permissions:this.permissions,to:this.to})}async delete(){let e=s.regions.get(this.key),n=new Xt(e.from.x,e.dimensionId=="minecraft:overworld"?-64:0,e.from.z),o=new Xt(e.to.x,e.dimensionId=="minecraft:overworld"?-64:0,e.to.z);for(let r of n.blocksBetween(o))y[e.dimensionId].getBlock(r)?.setType(mo.bedrock);return j=j.filter(r=>r.key!=this.key),s.regions.delete(this.key)}entityInRegion(e){return this.dimensionId==e.dimension.id&&Ce(e.location,{x:this.from.x,y:Xe,z:this.from.z},{x:this.to.x,y:Je,z:this.to.z})}changePermission(e,n){this.permissions[e]=n,this.update()}};var N=class{static getTasks(){return s.tasks.get("changePlayerRole")??[]}static getPlayersRoleToSet(e){return N.getTasks().find(o=>o.playerName==e)?.role}constructor(e,n){let o=N.getTasks();o.push({playerName:e,role:n}),s.tasks.set("changePlayerRole",o)}};import{MinecraftBlockTypes as Ze,MinecraftItemTypes as u}from"@minecraft/server";var Pe="https://discord.gg/dMa3A5UYKX",Hi=[u.beehive.id,u.beeNest.id,u.axolotlBucket.id,u.codBucket.id,u.tadpoleBucket.id,u.tropicalFishBucket.id,u.salmonBucket.id,u.pufferfishBucket.id],Jt=[u.allow.id,u.barrier.id,u.borderBlock.id,u.debugStick?.id??"minecraft:debug_stick",u.deny.id,u.jigsaw.id,u.lightBlock.id,u.commandBlock.id,u.repeatingCommandBlock.id,u.chainCommandBlock.id,u.commandBlockMinecart.id,u.structureBlock.id,u.structureVoid.id,u.bedrock.id,u.endPortalFrame.id,"minecraft:info_update","minecraft:info_update2","minecraft:reserved3","minecraft:reserved4","minecraft:reserved6","minecraft:movingBlock","minecraft:moving_block","minecraft:movingblock","minecraft:piston_arm_collision","minecraft:piston_arm_collision","minecraft:pistonarmcollision","minecraft:stickyPistonArmCollision","minecraft:sticky_piston_arm_collision","minecraft:unknown","minecraft:glowingobsidian","minecraft:invisible_bedrock","minecraft:invisiblebedrock","minecraft:netherreactor","minecraft:portal","minecraft:fire","minecraft:water","minecraft:lava","minecraft:flowing_lava","minecraft:flowing_water","minecraft:soul_fire"],Ui=[Ze.dispenser.id],Zt=[Ze.bedrock.id,Ze.barrier.id,"minecraft:invisiblebedrock","minecraft:movingBlock","minecraft:movingblock","minecraft:moving_block"],qi=[u.chest.id,u.trappedChest.id,u.barrel.id,u.dispenser.id,u.dropper.id,u.furnace.id,"minecraft:lit_furnace",u.blastFurnace.id,"minecraft:lit_blast_furnace",u.smoker.id,"minecraft:lit_smoker",u.hopper.id,u.shulkerBox.id,u.undyedShulkerBox.id];var Ae={aquaAffinity:1,baneOfArthropods:5,binding:1,blastProtection:4,channeling:1,depthStrider:3,efficiency:5,featherFalling:4,fireAspect:2,fireProtection:4,flame:1,fortune:3,frostWalker:2,impaling:5,infinity:1,knockback:2,looting:3,loyalty:4,luckOfTheSea:3,lure:3,mending:1,multishot:1,piercing:4,power:5,projectileProtection:4,protection:4,punch:2,quickCharge:3,respiration:3,riptide:3,sharpness:5,silkTouch:1,smite:5,soulSpeed:3,swiftSneak:4,thorns:3,unbreaking:3,vanishing:1};function _(t,e=[],n){if(ue(t))return console.warn("[WARNING]: TRIED TO KICK OWNER"),t.tell("You have been tried to kick, but you cant!"),n?.();try{t.runCommandAsync(`kick "${t.name}" \xA7r${e.join(`
`)}`),t.triggerEvent("kick")}catch(o){if(t.triggerEvent("kick"),!/"statusCode":-2147352576/.test(o))return;n&&n()}}function c(t){return t instanceof uo?s.roles.get(t.name)??"member":s.roles.get(t)??"member"}function J(t,e){if(typeof t=="string"){s.roles.set(t,e);let n=[...Y.getPlayers()].find(o=>o.name==t);n?n.setDynamicProperty("role",e):new N(t,e)}else s.roles.set(t.name,e),t.setDynamicProperty("role",e)}function ue(t){return Y.getDynamicProperty("worldsOwner")==t.id}function et(){let t=Y.getDynamicProperty("worldsOwner");return!t||t==""?null:t}function tn(){let t=et();if(!t)return null;let e=s.ids.collection();return Object.keys(e).find(n=>e[n]===t)}function de(t){if(!t)return Y.setDynamicProperty("worldsOwner","");Y.setDynamicProperty("worldsOwner",t.id.toString())}function xe(){return Y.getDynamicProperty("isLockDown")??!1}function tt(t){Y.setDynamicProperty("isLockDown",t)}function Se(){for(let t of f.getAllRegions()){let e=new en(t.from.x,t.dimensionId=="minecraft:overworld"?-64:0,t.from.z),n=new en(t.to.x,t.dimensionId=="minecraft:overworld"?-64:0,t.to.z);for(let o of e.blocksBetween(n))y[t.dimensionId].getBlock(o)?.setType(po.deny)}}function A(t){switch(t){case"banned_items":return s.config.get("banned_items")??Jt;case"banned_blocks":return s.config.get("banned_blocks")??Zt;case"enchantments":return s.config.get("enchantments")??Ae;case"appealLink":return s.config.get("appealLink")??Pe}}function G(t,e){s.config.set(t,e)}var M=new fo(go.acaciaBoat,0);C.subscribe(()=>{nn.runSchedule(()=>{for(let t of yo.getPlayers()){if(jt(t)?.typeId!=zt){P[t.name]&&P[t.name].despawn();continue}Object.keys(P).includes(t?.name)||c(t)=="admin"&&(P[t.name]=new X(t))}},10)});nn.runSchedule(()=>{let t=Object.values(P).map(e=>e.entity.id);for(let e of y.overworld.getEntities({type:ce}))t.includes(e.id)||e.triggerEvent("despawn")},100);import{DynamicPropertiesDefinition as ho,EntityTypes as bo,world as ko}from"@minecraft/server";ko.events.worldInitialize.subscribe(({propertyRegistry:t})=>{y.overworld.runCommandAsync(`tickingarea add ${T.x} ${T.y} ${T.z} ${T.x} ${T.y} ${T.z} db true`);let e=new ho;e.defineString("tableName",30),e.defineNumber("index"),t.registerEntityTypeDynamicProperties(e,bo.get(ne))});import{system as Io,world as wo}from"@minecraft/server";import{MinecraftBlockTypes as on}from"@minecraft/server";var Re=[on.chest.id,on.trappedChest.id],K={x:7,y:7,z:7};var Me=class{constructor(e){this.emptySlotsCount=e.emptySlotsCount,this.size=e.size,this.items=[];for(let n=0;n<this.size;n++)this.items[n]=e.getItem(n)}load(e){for(let n=0;n<e.size;n++)!this.items[n]||e.setItem(n,this.items[n])}};var Ne={};Io.runSchedule(()=>{Ne={};for(let t of wo.getPlayers()){if(t.dimension.id!="minecraft:overworld")continue;let e=we(t.location),n=e.offset(K.x,K.y,K.z),o=e.offset(-K.x,-K.y,-K.z);for(let r of n.blocksBetween(o)){if(r.y<-64)continue;let i=t.dimension.getBlock(r);!i||!Re.includes(i.typeId)||(Ne[JSON.stringify(r)]=new Me(i.getComponent("inventory").container))}}},100);var pe={};s.protections.onLoad(()=>{for(let t of Object.values(pe))!t.getConfig().enabled||t.enable()});import{Player as sn}from"@minecraft/server";function rn(t,e,n,o="No Reason",r="Rubedo Auto Mod"){let i={key:e,playerName:t instanceof sn?t.name:t,date:Date.now(),duration:n?oe(n):null,expire:n?oe(n)+Date.now():null,reason:o,by:r};s.bans.set(e,i)}var $=class{constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){e instanceof sn?rn(e,e.id,n,o,r):rn(e,s.ids.get(e),n,o,r)}};import{MessageFormData as Co}from"@minecraft/server-ui";var Z=class{constructor(e,n){this.title=e,this.body=n,this.form=new Co,e&&this.form.title(e),n&&this.form.body(n),this.triedToShow=0}setButton1(e,n){return this.button1={text:e,callback:n},this.form.button1(e),this}setButton2(e,n){return this.button2={text:e,callback:n},this.form.button2(e),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}n.selection==1&&this.button1?.callback?.(),n.selection==0&&this.button2?.callback?.()})}};function H(t,e,n,o=()=>{}){new Z("Confirm To Continue",e).setButton1("Confirm",n).setButton2("Never Mind",o).show(t)}var m=class{constructor(e,n,o=0,r){this.data=e;this.type=n;this.depth=o;this.parent=r;e.requires||(e.requires=i=>!0),this.data=e,this.type=n??new D(this.data.name),this.children=[],this.depth=o,this.parent=r,this.callback=null,z.push(this)}argument(e){let n=new m(this.data,e,this.depth+1,this);return this.children.push(n),n}string(e){return this.argument(new ie(e))}int(e){return this.argument(new se(e))}array(e,n){return this.argument(new le(e,n))}boolean(e){return this.argument(new ae(e))}location(e){let n=this.argument(new F(e));return e.endsWith("*")?n:n.location(e+"_y*").location(e+"_z*")}literal(e){let n=new m(e,new D(e.name),this.depth+1,this);return this.children.push(n),n}executes(e){return this.callback=e,this}};var w={"api.name":()=>"Smelly API","api.error.unknown":()=>"An unknown error has occurred.","api.database.error.table_name":(t,e)=>`The display name ${t} is too long for an objective, it can be at most ${e} characters long`,"api.utilities.formatter.error.ms":t=>`${t} is not a string or a number`,"api.Providers.form.invalidType":(t,e)=>`Type ${t} is not a valid type to add a ${e}`,"modules.protections.cps.clickingToFast":()=>"You are clicking to fast! Please click slower!","modules.managers.mute.isMuted":()=>"\xA7cYou've been temporarily muted in chat.","modules.commands.ban.reply":(t,e,n="")=>`\xA7cBanned \xA7f"\xA7a${t}\xA7f" \xA7cfor ${e} Because: "${n??"No reason Provided"}" \xA7aSuccessfully`,"lockdown.kick.message":()=>["\xA7cYou have been kicked!","\xA7aReason: \xA7fServer is currently under LockDown","\xA7fServer will be up soon, Try to join later"],"commands.ban.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry ${n}`,"commands.freeze.list.player":(t,e)=>`- "${t}" Because: ${e}`,"commands.mutes.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry: ${n}`,"commands.lockdown.confirm":"Are you sure you want to lockdown the server, this will kick all active players and all players who try to join who are not admin"};function nt(t,e,n,o,r){if(s.bans.get(s.ids.get(e)))return t.reply(`\xA7c${e} is already banned`);t.reply("\xA7aClose chat to confirm"),H(t.sender,`Are you sure you want to ban ${e}, for ${n??"forever"}`,()=>{new $(e,n,o,t.sender.name),t.reply(w["modules.commands.ban.reply"](e,n,o))})}var ot=new m({name:"ban",description:"Manage bans",requires:t=>["admin","moderator"].includes(c(t))});ot.literal({name:"add",description:"Bans a player"}).argument(new p.playerName).executes((t,e)=>{nt(t,e,null,null,t.sender.name)}).argument(new p.duration("duration")).executes((t,e,n)=>{nt(t,e,n,null,t.sender.name)}).string("reason").executes((t,e,n,o)=>{nt(t,e,n,o,t.sender.name)});ot.literal({name:"remove",description:"un-bans a player"}).argument(new p.playerName("playerName")).executes((t,e)=>{let n=s.bans.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not banned`);s.bans.delete(n.key)?t.reply(`\xA7a${e}\xA7r has been Unbanned!`):t.reply(`\xA7cFailed to un-ban ${e}`)});ot.literal({name:"list",description:"Lists all bans"}).executes(t=>{let e=s.bans.values();if(e.length==0)return t.sender.tell("\xA7cNo one is banned!");t.sender.tell(`\xA72--- Showing Bans (${e.length}) ---`);for(let n of e)t.sender.tell(w["commands.ban.list.player"](n.playerName,n.reason,n.expire?W(n.duration):"Forever"))});var ge=new m({name:"database",description:"Interacts with SA Database",aliases:["db"],requires:t=>c(t)=="admin"});ge.literal({name:"get"}).string("table").string("key").executes((t,e,n)=>{try{let o=s[e].get(n);o?t.reply(JSON.stringify(o)):t.reply(`No data could be found for key ${n}`)}catch(o){t.reply(o+o.stack)}});ge.literal({name:"set"}).string("table").string("key").string("value").executes((t,e,n,o)=>{try{s[e].set(n,o),t.reply(`Set Key: "${n}", to value: "${o}" on table: "${e}"`)}catch(r){t.reply(r+r.stack)}});ge.literal({name:"clear"}).string("table").executes((t,e)=>{try{s[e].clear(),t.reply(`Cleared Table ${e}`)}catch(n){t.reply(n+n.stack)}});ge.literal({name:"keys",description:"Returns all keys on a database"}).string("table").executes((t,e)=>{try{let n=s[e].keys();t.reply(`Keys on database: ${e}: ${n}`)}catch(n){t.reply(n+n.stack)}});ge.literal({name:"values",description:"Returns all values on a database"}).string("table").executes((t,e)=>{try{let n=s[e].values();t.reply(`Values on database: ${e}: ${JSON.stringify(n,null,2)}`)}catch(n){n instanceof TypeError?t.reply(`No values on database ${e}`):t.reply(n+n.stack)}});new m({name:"ecwipe",description:"Clears a players ender chest",requires:t=>c(t)=="admin"}).argument(new p.player("player")).executes((t,e)=>{for(let n=0;n<27;n++)e.runCommandAsync(`replaceitem entity @s slot.enderchest ${n} air`);t.reply(`\xA7aCleared "${e.name}"'s Ender chest!`)});var Be=class{constructor(e,n="No Reason"){let o={playerName:e.name,key:e.id,reason:n,location:{x:e.location.x,y:e.location.y,z:e.location.z,dimension:e.dimension.id}};s.freezes.set(e.id,o)}};var rt=new m({name:"freeze",description:"Manage Freezes",requires:t=>["admin","moderator"].includes(c(t))});rt.literal({name:"add",description:"Freezes a player"}).argument(new p.player("player")).string("reason").executes((t,e,n)=>{new Be(e,n),t.reply(`\xA7cFroze \xA7f"\xA7a${e.name}\xA7f" Because: "${n}" \xA7aSuccessfully`),t.sender.tell(`\xA7cYou have been frozen by \xA7f"\xA7a${t.sender.name}\xA7f" Because: "${n}"`)});rt.literal({name:"remove",description:"unfreezes a player"}).argument(new p.playerName("playerName")).executes((t,e)=>{let n=s.freezes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not frozen`);s.freezes.delete(n.key),t.reply(`\xA7a${e}\xA7r has been UnFrozen!`)});rt.literal({name:"list",description:"Lists all freezes"}).executes(t=>{let e=s.freezes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is frozen!");t.sender.tell(`\xA72--- Showing Freezes (${e.length}) ---`);for(let n of e)t.sender.tell(w["commands.freeze.list.player"](n.playerName,n.reason))});var it=class{constructor(e){this.name=e;this.typeName="CommandName"}matches(e){return{success:Boolean(z.find(n=>n.depth==0&&n.data.name==e)),value:e}}fail(e){return`"${e}" is not a valid command`}};function Eo(t,e,n){n.tell(`${I}${t.data.name} ${e.map(o=>o.type.typeName=="literal"?o.data.name:`<${o.type.name}: ${o.type.typeName}>`).join(" ")}`)}function Le(t,e,n,o){if(!!e.data?.requires(o)&&(e.callback&&Eo(t,e.depth==0?n:n.concat(e),o),e.children.length>0))for(let r of e.children)Le(t,r,e.depth==0?n:n.concat(e),o)}function an(t,e,n){t.tell(`\xA72--- Showing help page ${e} of ${n} (${I}help <page: int>) ---`)}function st(t){return z.filter(e=>e.depth==0&&e.data?.requires(t))}function ln(t){let e=st(t);return e.length==0?0:Math.ceil(e.length/5)}var cn=new m({name:"help",description:"Provides help/list of commands.",aliases:["?","h"]}).executes(t=>{let e=ln(t.sender),n=st(t.sender).slice(1*5-5,1*5);an(t.sender,1,e);for(let o of n)Le(o,o,[],t.sender)});cn.int("page").executes((t,e)=>{let n=ln(t.sender);e>n&&(e=n);let o=st(t.sender).slice(e*5-5,e*5);an(t.sender,e,n);for(let r of o)Le(r,r,[],t.sender)});cn.argument(new it("command")).executes((t,e)=>{let n=z.filter(o=>o.depth==0&&o.data.name==e)[0];t.sender.tell(`\xA7e${n.data.name}: ${n.data.aliases?`aliases (${n.data.aliases.join(", ")})`:""}`),t.sender.tell(`\xA7e${n.data.description}`),t.sender.tell("Usage:"),Le(n,n,[],t.sender)});import{world as mn}from"@minecraft/server";new m({name:"lockdown",description:"Toggles the servers lockdown, meaning no one can join",requires:t=>c(t)=="admin"}).executes(t=>{xe()?(tt(!1),t.sender.tell("\xA7aUnlocked the server!")):(t.reply("\xA7aClose chat to confirm lockdown"),H(t.sender,w["commands.lockdown.confirm"],()=>{tt(!0);for(let e of mn.getPlayers())c(e)!="admin"&&_(e,w["lockdown.kick.message"]());mn.say("\xA7l\xA7cServer is now LOCKED!")}))});var x=class{static getMuteData(e){return s.mutes.get(e.name)}constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){let i=n?oe(n):null,a={playerName:e.name,date:Date.now(),duration:i,expire:i?i+Date.now():null,reason:o,by:r};s.mutes.set(e.name,a)}};var at=new m({name:"mute",description:"Manage Mutes",requires:t=>["admin","moderator"].includes(c(t))});at.literal({name:"add",description:"Mutes a player"}).argument(new p.player("player")).argument(new p.duration("duration")).string("reason").executes((t,e,n,o)=>{new x(e,n,o,t.sender.name),t.reply(`\xA7cMuted \xA7f"\xA7a${e.name}\xA7f" \xA7cfor ${n} Because: "${o}" \xA7aSuccessfully`),e.tell(`\xA7cYou have been muted by \xA7f"${t.sender.name}" \xA7cfor ${n} Because: "${o}"`)});at.literal({name:"remove",description:"un-mutes a player"}).argument(new p.playerName("playerName")).executes((t,e)=>{let n=s.mutes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not muted!`);s.mutes.delete(n.playerName);try{t.sender.runCommandAsync(`ability "${e}" mute false`)}catch{}t.reply(`\xA7a${e}\xA7r has been UnMuted!`)});at.literal({name:"list",description:"Lists all freezes"}).executes(t=>{let e=s.mutes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is muted!");t.sender.tell(`\xA72--- Showing Mutes (${e.length}) ---`);for(let n of e)t.sender.tell(w["commands.mutes.list.player"](n.playerName,n.reason,n.expire?W(n.expire):"Forever"))});import{Location as To}from"@minecraft/server";var De=class{static isValid(e){return e.typeId!="minecraft:npc"?!1:Oe.find(n=>Mt(n,e.location))?!0:!!s.npcs.keys().find(n=>e.id==n)}constructor(e,n){Oe.push(e);let o=n.spawnEntity("minecraft:npc",e),r={dimension:o.dimension.id,x:o.location.x,y:o.location.y,z:o.location.z};s.npcs.set(o.id,r),un()}};new m({name:"npc",description:"Spawns a npc at your coordinates",requires:t=>c(t)=="admin"}).executes(t=>{let{x:e,y:n,z:o}=t.sender.location;new De(new To(e,n,o),t.sender.dimension),t.reply("Spawned a verified npc at your current location")});import{system as dn}from"@minecraft/server";async function vo(){let t=Date.now(),e=0;return new Promise(n=>{let o=dn.runSchedule(()=>{Date.now()-t<1e3?e++:(dn.clearRunSchedule(o),n(e))})})}new m({name:"ping",description:"Returns the current Ticks Per Second of the servers ping"}).executes(async t=>{let e=await vo();t.reply(`\xA7aCurrent Ticks Per Second: ${e>18?"\xA7f{ \xA7aGood":e>13?"\xA7f{ \xA7eOk":"\xA7f{ \xA7cSevere"} ${e} \xA7f}`)});import{BlockLocation as ye}from"@minecraft/server";var he=new m({name:"region",description:"Create a Region",requires:t=>c(t)=="admin"});he.literal({name:"add",description:"Adds a new protection region"}).int("from_x").int("from_z").int("to_x").int("to_z").executes((t,e,n,o,r)=>{new f({x:e,z:n},{x:o,z:r},t.sender.dimension.id),t.reply(`Created Region From ${e} -64 ${n} ${o} 320 ${r}`)});he.literal({name:"remove",description:"Removes a region at the players current position"}).executes(t=>{let e=new ye(t.sender.location.x,t.sender.location.y,t.sender.location.z);f.removeRegionAtBlockLocation(e,t.sender.dimension.id)?t.reply(`Removed Region at ${e.x} ${e.y} ${e.z}`):t.reply(`Failed to find/remove region at ${e.x} ${e.y} ${e.z}`)});he.literal({name:"removeAll",description:"Removes all regions"}).executes(t=>{f.getAllRegions().forEach(e=>e.delete()),t.reply("Removed All regions")});he.literal({name:"list",description:"Lists all regions and positions"}).executes(t=>{let e=f.getAllRegions();for(let n of e)t.reply(`Region from ${n.from.x}, ${n.from.z} to ${n.to.x}, ${n.to.z} in dimension ${n.dimensionId}`);if(e.length==0)return t.reply("No regions have been made yet")});var lt=he.literal({name:"permission",description:"Handles permissions for regions"});lt.literal({name:"set",description:"Sets a certain permission on the region the player is currently in to a value"}).array("key",["doorsAndSwitches","openContainers","pvp"]).boolean("value").executes((t,e,n)=>{let o=f.blockLocationInRegion(new ye(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!o)return t.reply("You are not in a region");o.changePermission(e,n),t.reply(`Changed permission ${e} to ${n}`)});lt.literal({name:"list",description:"Lists the permissions for the current region"}).executes(t=>{let e=f.blockLocationInRegion(new ye(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!e)return t.reply("You are not in a region");t.reply(`Current region permissions ${JSON.stringify(e.permissions)}`)});var pn=lt.literal({name:"entities",description:"Holds the subCommands for adding or removing allowedEntities"});pn.literal({name:"add",description:"Adds a entity to the allowed entities list"}).string("entity").executes((t,e)=>{let n=f.blockLocationInRegion(new ye(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntities;o.push(e),n.changePermission("allowedEntities",o),t.reply(`Added entity ${e} to the allowed entities of the region your currently standing in`)});pn.literal({name:"remove",description:"Removes a entity from the allowed entities in the region"}).string("entity").executes((t,e)=>{let n=f.blockLocationInRegion(new ye(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntities;if(!o.includes(e))return t.reply(`The entity ${e} is not allowed to enter the region`);o=o.filter(r=>r!=e),n.changePermission("allowedEntities",o),t.reply(`Removed entity ${e} to the allowed entities of the region your currently standing in`)});var ct=(r=>(r[r.member=0]="member",r[r.admin=1]="admin",r[r.moderator=2]="moderator",r[r.builder=3]="builder",r))(ct||{});var So=t=>isNaN(Number(t))===!1;function Po(t){return Object.keys(t).filter(So).map(e=>t[e])}var mt=new m({name:"role",description:"Changes the role for a player",requires:t=>c(t)=="admin"||ue(t)});mt.literal({name:"set",description:"Sets the role for a player"}).argument(new p.playerName("playerName")).argument(new p.array("role",Po(ct))).executes((t,e,n)=>{J(e,n),t.reply(`Changed role of ${e} to ${n}`)});mt.literal({name:"get",description:"Gets the role of a player"}).argument(new p.playerName("playerName")).executes((t,e)=>{let n=c(e);t.reply(`${e} has role: ${n}`)});var ut=mt.literal({name:"owner",description:"Manages the owner"});ut.literal({name:"get",description:"Gets the owner of the world"}).executes(t=>{let e=et(),n=s.ids.collection(),o=Object.keys(n).find(r=>n[r]===e);t.reply(`\xA7aServer Owner: ${o} (id: ${e})`)});ut.literal({name:"transfer",description:"Transfers the owner of the world",requires:t=>ue(t)}).argument(new p.player).executes((t,e)=>{H(t.sender,`Are you sure you want to transfer the server ownership to ${e.name}, this action is not reversible!`,()=>{de(e),t.reply(`\xA7aSet the server Owner to: ${e.name} (id: ${e.id})`)}),t.reply("\xA7aClose chat to confirm")});ut.literal({name:"clear",description:"clear's the owner of the world",requires:t=>ue(t)}).executes(t=>{H(t.sender,"Are you sure you want to clear the server owner, this action is not reversible!",()=>{de(null),t.reply('\xA7aCleared the server owner! run "/reload" or reload world to run "/function start" again!')}),t.reply("\xA7aClose chat to confirm")});import{ActionFormData as Ao}from"@minecraft/server-ui";var B=class{constructor(e,n){this.title=e,this.body=n,this.form=new Ao,e&&this.form.title(e),n&&this.form.body(n),this.buttons=[],this.triedToShow=0}addButton(e,n=null,o){return this.buttons.push({text:e,iconPath:n,callback:o}),this.form.button(e,n),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}this.buttons[n.selection].callback?.()})}};import{ModalFormData as xo}from"@minecraft/server-ui";var _e=class{constructor(e,n,o){this.form=e,this.player=n,this.callback=o}error(e){new Z("Error",e).setButton1("Return to form",()=>{this.form.show(this.player,this.callback)}).setButton2("Cancel",null).show(this.player)}};var v=class{constructor(e){this.title=e,this.form=new xo,e&&this.form.title(e),this.args=[]}addDropdown(e,n,o){return this.args.push({type:"dropdown",options:n}),this.form.dropdown(e,n,o),this}addSlider(e,n,o,r,i){return this.args.push({type:"slider"}),this.form.slider(e,n,o,r,i),this}addToggle(e,n){return this.args.push({type:"toggle"}),this.form.toggle(e,n),this}addTextField(e,n,o){return this.args.push({type:"textField"}),this.form.textField(e,n,o),this}async show(e,n){for(let o=0;o<200;o++){let r=await this.form.show(e);if(r.cancelationReason!="userBusy"){n(new _e(this,e,n),...r.formValues.map((i,a)=>this.args[a].type=="dropdown"?this.args[a].options[i]:i));return}}return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)")}};function fn(t){new B("Manage Banned Items").addButton("Remove a Banned Item",null,()=>{Ro(t)}).addButton("Ban an item",null,()=>{Mo(t)}).show(t)}function Ro(t){new v("Remove Banned Items").addDropdown("Select item to remove",A("banned_items")).show(t,(e,n)=>{let o=A("banned_items");o=o.filter(r=>r!=n),G("banned_items",o),t.tell(`Removed Banned item "${n}"`)})}function Mo(t){new v("Add Banned Item").addTextField("Item Id","minecraft:string").show(t,(e,n)=>{let o=A("banned_items");if(o.includes(n))return e.error(`\xA7cItem "${n}" is already banned`);o.push(n),G("banned_items",o),t.tell(`Banned the item "${n}"`)})}function gn(t){new B("Manage Banned Blocks").addButton("Remove a Banned Block",null,()=>{No(t)}).addButton("Ban an block",null,()=>{Bo(t)}).show(t)}function No(t){new v("Remove Banned Block").addDropdown("Select block to remove",A("banned_blocks")).show(t,(e,n)=>{let o=A("banned_blocks");o=o.filter(r=>r!=n),G("banned_blocks",o),t.tell(`Removed Banned block "${n}"`)})}function Bo(t){new v("Add Banned Block").addTextField("Block Id","minecraft:barrier").show(t,(e,n)=>{let o=A("banned_blocks");if(o.includes(n))return e.error(`\xA7cBlock "${n}" is already banned`);o.push(n),G("banned_blocks",o),t.tell(`Banned the block "${n}"`)})}function yn(t){new v("Manage Enchantment Levels").addDropdown("Enchantment to change",Object.keys(Ae),0).addTextField("Level (number)","5").show(t,(e,n,o)=>{if(isNaN(o))return e.error(`\xA7c"${o}" is not a number, please enter a value like, "3", "9", etc.`);let r=parseInt(o),i=A("enchantments");i[n]=r,G("enchantments",i),t.tell(`Set max level for ${n} to ${r}`)})}function hn(t){new v("Manage Appeal Link").addTextField("Appeal Link",Pe).show(t,(e,n)=>{G("appealLink",n),t.tell(`Changed the servers appeal link to ${n}`)})}function bn(t){let e=new B("Manage Protections");for(let n of Object.values(pe))e.addButton(n.name,n.iconPath,()=>{Do(n,t)});e.addButton("Back","textures/ui/arrow_dark_left_stretch.png",()=>{$e(t)}).show(t)}function Do(t,e){let n=t.getConfig(),o=new v(`Manage ${t.name} Protection Config`).addToggle("Enabled",n.enabled),r=[];for(let[i,a]of Object.entries(t.configDefault))r.push(i),typeof a.defaultValue=="boolean"?o.addToggle(a.description,n[i]):typeof a.defaultValue=="number"?o.addSlider(a.description,0,100,1,n[i]):o.addTextField(a.description,null,n[i]);o.show(e,(i,a,...l)=>{a!=n.enabled&&(a&&t.enable(),a||t.disable());let d={enabled:a};for(let[g,b]of Object.keys(t.configDefault).entries())d[b]=l[g];t.setConfig(d),e.tell(`Updated config for ${t.name}!`)})}function $e(t){new B("Rubedo Settings").addButton("Auto Mod","textures/ui/permissions_op_crown.png",()=>{bn(t)}).addButton("Banned items","textures/blocks/sculk_shrieker_top.png",()=>{fn(t)}).addButton("Banned blocks","textures/blocks/barrier.png",()=>{gn(t)}).addButton("Enchantments","textures/items/book_enchanted.png",()=>{yn(t)}).addButton("Appeal Link","textures/ui/Feedback.png",()=>{hn(t)}).show(t)}new m({name:"settings",description:"Opens up the settings menu for the player",requires:t=>["admin","moderator"].includes(c(t))}).executes(t=>{$e(t.sender),t.sender.tell("\xA7aForm request sent, close chat to continue!")});import{world as kn}from"@minecraft/server";function In(t,e){if(t.hasTag("spectator")){if(t.runCommandAsync("gamemode c"),t.triggerEvent("removeSpectator"),t.removeTag("spectator"),!e)return;kn.say({rawtext:[{translate:"multiplayer.player.joined",with:[`\xA7e${t.name}`]}]})}else{if(t.runCommandAsync("gamemode spectator"),t.triggerEvent("addSpectator"),t.addTag("spectator"),!e)return;kn.say({rawtext:[{translate:"multiplayer.player.left",with:[`\xA7e${t.name}`]}]})}}new m({name:"vanish",description:"Toggles Vanish Mode on the sender",requires:t=>c(t)=="admin"}).executes(t=>{In(t.sender,!1)}).boolean("say").executes((t,e)=>{In(t.sender,e)});var wn="2.7.0-beta";new m({name:"version",description:"Get Current Rubedo Version",aliases:["v"]}).executes(t=>{t.reply(`Current Rubedo Version: ${wn}`)});new m({name:"kick",description:"Kicks a player from the game",requires:t=>c(t)=="admin"}).argument(new p.player).string("reason").executes((t,e,n)=>{_(e,[n]),t.reply(`\xA7aKicked ${e.name} from world`)});var ee=class{constructor(e){this.data=e,console.warn(`[LOG]: ${e.message}`),s.logs.set(Date.now().toString(),e)}};function dt(t){var e=6e4,n=e*60,o=n*24,r=o*30,i=o*365,a=Date.now()-t;return a<e?Math.round(a/1e3)+" seconds ago":a<n?Math.round(a/e)+" minutes ago":a<o?Math.round(a/n)+" hours ago":a<r?"approximately "+Math.round(a/o)+" days ago":a<i?"approximately "+Math.round(a/r)+" months ago":"approximately "+Math.round(a/i)+" years ago"}var be=new m({name:"log",description:"Manages the log command",requires:t=>c(t)=="admin"});be.literal({name:"add",description:"Adds a new log"}).string("message").executes((t,e)=>{new ee({message:e}),t.reply(`\xA7aAdded new log: ${e}`)});be.literal({name:"getAll",description:"Gets all logs sorted in descending"}).int("page").array("order",["ascending","descending"]).executes((t,e,n)=>{let o=Object.entries(s.logs.collection()).sort((i,a)=>n=="ascending"?parseInt(a[0])-parseInt(i[0]):parseInt(i[0])-parseInt(a[0]));if(o.length==0)return t.reply("\xA7cNo Logs have been made!");let r=Math.ceil(o.length/8);e>r&&(e=r),t.reply(`\xA72--- Showing logs page ${e} of ${r} (${I}log getAll <page: int>) ---`);for(let[i,a]of o.slice(e*8-8,e*8))t.reply(`${dt(parseInt(i))}: ${a.message}`)});be.literal({name:"getPlayersLogs",description:"Gets all logs associated with a player"}).argument(new p.playerName).int("page").array("order",["ascending","descending"]).executes((t,e,n,o)=>{let r=Object.entries(s.logs.collection()).filter(a=>a[1].playerName==e).sort((a,l)=>o=="ascending"?parseInt(l[0])-parseInt(a[0]):parseInt(a[0])-parseInt(l[0]));if(r.length==0)return t.reply(`\xA7cNo Logs exists for "${e}"!`);let i=Math.ceil(r.length/8);n>i&&(n=i),t.reply(`\xA72--- Showing logs for "${e}" page ${n} of ${i} ---`);for(let[a,l]of r.slice(n*8-8,n*8))t.reply(`${dt(parseInt(a))}: ${l.message}`)});be.literal({name:"getProtectionLogs",description:"Gets all logs associated with a protection"}).string("protection").int("page").array("order",["ascending","descending"]).executes((t,e,n,o)=>{let r=Object.entries(s.logs.collection()).filter(a=>a[1].protection==e).sort((a,l)=>o=="ascending"?parseInt(l[0])-parseInt(a[0]):parseInt(a[0])-parseInt(l[0]));if(r.length==0)return t.reply(`\xA7cNo Logs exists for protection: "${e}"!`);let i=Math.ceil(r.length/8);n>i&&(n=i),t.reply(`\xA72--- Showing logs for Protection: "${e}" page ${n} of ${i} ---`);for(let[a,l]of r.slice(n*8-8,n*8))t.reply(`${dt(parseInt(a))}: ${l.message}`)});be.literal({name:"clearAll",description:"Clears all logs"}).executes(t=>{s.logs.clear(),t.reply("\xA7aCleared All logs!")});var _o=new m({name:"teleport",description:"Teleports entities (players, mobs, etc.).",aliases:["tp"],requires:t=>c(t)=="admin"});_o.argument(new p.player).location("destination").executes((t,e,n)=>{e.addTag("skip-movement-check"),e.teleport(n,e.dimension,0,0),t.reply(`Teleported ${e.name} to ${n.x} ${n.y} ${n.z}`)});import{system as pt,world as $o}from"@minecraft/server";var Fe={};C.subscribe(()=>{pt.runSchedule(()=>{let t=[...$o.getPlayers()];for(let[e,n]of t.entries())for(let o of Object.values(Fe))o.delay!=0&&pt.currentTick-o.lastCall<o.delay||(o.callback(n),e==t.length-1&&(o.lastCall=pt.currentTick))})});var S=class{static subscribe(e,n=0){let o=Object.keys(Fe).length;return Fe[o]={callback:e,delay:n,lastCall:0},o}static unsubscribe(e){delete Fe[e]}};s.bans.onLoad(()=>{S.subscribe(t=>{try{let e=s.bans.get(t.id);if(!e)return;if(e.expire&&e.expire<Date.now())return s.bans.delete(t.id);_(t,["\xA7cYou have been banned!",`\xA7aReason: \xA7f${e.reason}`,`\xA7fExpiry: \xA7b${e.expire?W(e.expire-Date.now()):"Forever"}`,`\xA7fAppeal at: \xA7b${A("appealLink")}`],()=>{console.warn(new Error("Failed to kick player")),s.bans.delete(t.id)})}catch(e){console.warn(e+e.stack)}},100)});import{Location as Fo}from"@minecraft/server";S.subscribe(t=>{try{let e=s.freezes.get(t.id);if(!e)return t.getComponent("movement").resetToDefaultValue();t.getComponent("movement").setCurrent(0),t.teleport(new Fo(e.location.x,e.location.y,e.location.z),y[e.location.dimension],0,0)}catch{}},200);import{world as zo}from"@minecraft/server";var ft={};zo.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(I))for(let e of Object.values(ft))e.callback(t)});var ze=class{static subscribe(e){let n=Date.now();return ft[n]={callback:e},n}static unsubscribe(e){delete ft[e]}};ze.subscribe(t=>{let e=x.getMuteData(t.sender);if(!!e){if(e.expire&&e.expire<Date.now())return s.mutes.delete(t.sender.name);t.cancel=!0,t.sender.tell(w["modules.managers.mute.isMuted"]())}});import{BlockLocation as Vo,system as Cn,world as gt}from"@minecraft/server";Cn.runSchedule(()=>{Se()},6e3);gt.events.beforeItemUseOn.subscribe(t=>{if(["moderator","admin"].includes(c(t.source)))return;let e=f.blockLocationInRegion(t.blockLocation,t.source.dimension.id);if(!e)return;let n=t.source.dimension.getBlock(t.blockLocation);Wt.includes(n.typeId)&&e.permissions.doorsAndSwitches||Qt.includes(n.typeId)&&e.permissions.openContainers||(t.cancel=!0)});gt.events.beforeExplosion.subscribe(t=>{for(let e=0;e<t.impactedBlocks.length;e++){let n=t.impactedBlocks[e];if(f.blockLocationInRegion(n,t.dimension.id))return t.cancel=!0}});gt.events.entitySpawn.subscribe(async({entity:t})=>{let e=await f.blockLocationInRegionSync(new Vo(t.location.x,t.location.y,t.location.z),t.dimension.id);!e||e.permissions.allowedEntities.includes(t.typeId)||(t.teleport({x:0,y:-64,z:0},t.dimension,0,0),t.kill())});C.subscribe(()=>{Cn.runSchedule(async()=>{for(let t of await f.getAllRegionsSync())for(let e of y[t.dimensionId].getEntities({excludeTypes:t.permissions.allowedEntities}))!t.entityInRegion(e)||(e.teleport({x:0,y:-64,z:0},e.dimension,0,0),e.kill())},100)});s.regions.onLoad(()=>{S.subscribe(t=>{for(let e of f.getAllRegions())e.entityInRegion(t)?(t.addTag("inRegion"),e.permissions.pvp||t.addTag("region-protected")):(t.removeTag("inRegion"),t.removeTag("region-protected"))},5)});import{world as jo}from"@minecraft/server";jo.events.playerSpawn.subscribe(({player:t})=>{s.ids.onLoad(()=>{if(xe()&&c(t)!="admin")return _(t,w["lockdown.kick.message"]());x.getMuteData(t)&&t.runCommandAsync("ability @s mute true"),s.ids.has(t.name)||s.ids.set(t.name,t.id);let e=N.getPlayersRoleToSet(t.name);e&&J(t,e)})});import{Items as Yo,MinecraftItemTypes as ke,world as En}from"@minecraft/server";var Tn=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44];function Go(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,M);continue}o.setItem(r,i.item.itemStack)}for(let[r,i]of[...En.getPlayers()].entries()){let a=Tn[r],l=new E(ke.skull,{nameTag:i.name,data:3});o.setItem(a,l.itemStack),e.slots[a]={item:l,action:d=>{d.PageAction("moderation:see_inventory",{name:i.name})}}}}function Ko(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let l=0;l<o.size;l++){let d=e.slots[l];if(!d||!d.item){o.setItem(l,M);continue}o.setItem(l,d.item.itemStack)}let r=[...En.getPlayers()].find(l=>l.name==n.name);r||(Object.values(P).find(d=>d.entity.id==t.id).despawn(),r.tell(`"${n.name}" Could not be found, Gui Crashed`));let i=r.getComponent("inventory").container,a=0;for(let l=0;l<i.size;l++){let d=i.getItem(l),g=Tn[a];if(a++,!d){o.setItem(g,M);continue}o.setItem(g,d),e.slots[g]={item:new E(Yo.get(d.typeId),{amount:d.amount,data:d.data},d),action:b=>{l<9?r.runCommandAsync(`replaceitem entity @s slot.hotbar ${l} air`):r.runCommandAsync(`replaceitem entity @s slot.inventory ${l-9} air`),b.GiveAction(),e.slots[g]={item:null,action:Wn=>{i.addItem(Wn.getItemAdded())}}}}}}new V("moderation:see",Go).setSlots([50],new E(ke.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("home")}).setSlots([48],new E(ke.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new V("moderation:see_inventory",Ko).setSlots([50],new E(ke.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new E(ke.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});import{GameMode as Uo,world as qo}from"@minecraft/server";import{system as vn,world as Sn}from"@minecraft/server";var R=class{constructor(e,n,o,r){this.name=e;this.description=n;this.iconPath=o;this.isEnabledByDefault=r;this.name=e,this.description=n,this.iconPath=o,this.configDefault={},this.isEnabled=!1,this.isEnabledByDefault=r,this.events={},this.schedules=[],this.forEachPlayers=[],pe[this.name]=this}setConfigDefault(e){return this.configDefault=e,s.protections.hasSync(this.name).then(n=>{if(n)return;let o={enabled:!0};for(let r of Object.keys(e))o[r]=e[r].defaultValue;s.protections.set(this.name,o)}),this}getConfig(){let e=s.protections.get(this.name);return e||(e={enabled:this.isEnabled}),e}async setConfig(e){return s.protections.set(this.name,e)}triggerChange(e){if(e){this.isEnabled=!0,this.onEnableCallback?.();for(let[n,o]of Object.entries(this.events)){if(o.triggered)continue;let r=Sn.events[n].subscribe(o.callback);o.triggered=!0,o.callback=r}for(let n of this.forEachPlayers){if(n.key)continue;let o=S.subscribe(n.callback,n.delay);n.key=o}for(let n of this.schedules){if(n.runScheduleId)continue;let o=vn.runSchedule(n.callback);n.runScheduleId=o}}else{this.isEnabled=!1,this.onDisableCallback?.();for(let[n,o]of Object.entries(this.events))!o.triggered||(Sn.events[n].unsubscribe(o.callback),o.triggered=!1);for(let n of this.forEachPlayers)!n.key||(S.unsubscribe(n.key),n.key=null);for(let n of this.schedules)!n.runScheduleId||(vn.clearRunSchedule(n.runScheduleId),n.runScheduleId=null)}}onEnable(e){return this.onEnableCallback=e,this}onDisable(e){return this.onDisableCallback=e,this}subscribe(e,n){return this.events[e]={callback:n,triggered:!1},this}runSchedule(e,n){return this.schedules.push({callback:e,tickInterval:n,runScheduleId:null}),this}forEachPlayer(e,n=0){return this.forEachPlayers.push({callback:e,delay:n,key:null}),this}enable(){this.triggerChange(!0)}disable(){this.triggerChange(!1)}};import{world as Ho}from"@minecraft/server";var k=class{constructor(){this.data=new Map,this.events={playerLeave:Ho.events.playerLeave.subscribe(e=>this.data.delete(e.playerName))}}set(e,n){this.data.set(e.name,n)}get(e){return this.data.get(e.name)}has(e){return this.data.has(e.name)}delete(e){this.data.delete(e.name)}clear(){this.data.clear()}playerNames(){return[...this.data.keys()]}includes(e){return this.playerNames().includes(e.name)}};var Wo=Uo.creative,Pn=new k,An=new R("gamemode","Blocks illegal gamemode","textures/ui/creative_icon.png",!0).setConfigDefault({clearPlayer:{description:"Whether to clear players inventory.",defaultValue:!0},setToSurvival:{description:"If player should be set to survival after being flagged.",defaultValue:!0},banPlayer:{description:"If player should be banned after violation count is met.",defaultValue:!1},violationCount:{description:"The amount of violations before ban.",defaultValue:0}});An.runSchedule(()=>{let t=An.getConfig();for(let e of qo.getPlayers({gameMode:Wo})){if(["moderator","admin","builder"].includes(c(e)))continue;try{t.setToSurvival&&e.runCommandAsync("gamemode s"),t.clearPlayer&&e.runCommandAsync("clear @s")}catch{}new ee({playerName:e.name,protection:"Gamemode",message:`${e.name} has entered into a illegal gamemode!`});let n=(Pn.get(e)??0)+1;Pn.set(e,n),t.banPlayer&&n>=t.violationCount&&new $(e,null,"Illegal Gamemode")}},20);import{MinecraftBlockTypes as rr,MinecraftEffectTypes as ir,MinecraftItemTypes as Et,Player as Ve,system as Tt}from"@minecraft/server";import{system as xn,world as Qo}from"@minecraft/server";var yt={};function Xo(t,e){return!(t.x!=e.x||t.y!=e.y||t.z!=e.z)}var ht=new k;xn.runSchedule(()=>{let t=(e,n)=>{for(let o of Object.values(yt))o.callback(e,n)};for(let e of Qo.getPlayers()){let n=ht.get(e);n&&Xo(e.location,n.location)||(ht.set(e,{location:e.location,dimension:e.dimension,currentTick:xn.currentTick}),n&&t(e,n))}});var L=class{static subscribe(e){let n=Date.now();return yt[n]={callback:e},n}static unsubscribe(e){delete yt[e]}static delete(e){ht.delete(e)}};var Rn={walk:{velocity:.17,distance:.23},run:{velocity:.19,distance:.35}},Mn=.056,Nn=10,Bn=["gliding","riding"],Ln=32767.001953125,Dn=60;import{world as Jo,Location as Zo,system as er}from"@minecraft/server";var bt={};Jo.events.blockBreak.subscribe(t=>{for(let e of Object.values(bt))e.callback(new kt(t.block,t.brokenBlockPermutation,t.dimension,t.player))});var Ie=class{static subscribe(e){let n=Date.now();return bt[n]={callback:e},n}static unsubscribe(e){delete bt[e]}},kt=class{constructor(e,n,o,r){this.block=e;this.brokenBlockPermutation=n;this.dimension=o;this.player=r;this.block=e,this.brokenBlockPermutation=n,this.dimension=o,this.player=r}set cancel(e){if(this.dimension.getBlock(this.block.location).setPermutation(this.brokenBlockPermutation.clone()),Re.includes(this.brokenBlockPermutation.type.id)){let n=Ne[JSON.stringify(this.block.location)];n&&n.load(this.block.getComponent("inventory").container)}er.run(()=>{[...this.dimension.getEntities({maxDistance:2,type:"minecraft:item",location:new Zo(this.block.location.x,this.block.location.y,this.block.location.z)})].forEach(n=>n.kill())})}};var On=new k,tr=15,It=["snow","lush_plants_replaceable","azalea_log_replaceable","minecraft:crop","fertilize_area","plant"],nr=["minecraft:water","minecraft:flowing_water","minecraft:lava","minecraft:flowing_lava","minecraft:bedrock"],_n=new k,$n=null,Fn=new R("nuker","Blocks block breaking too fast","textures/blocks/dirt.png",!0).setConfigDefault({banPlayer:{description:"If the player should be banned once violation count is met",defaultValue:!1},violationCount:{description:"Violations before ban",defaultValue:0}});Fn.onEnable(()=>{let t=Fn.getConfig();$n=Ie.subscribe(e=>{if(["moderator","admin"].includes(c(e.player))||e.block.getTags().some(o=>It.includes(o)))return;let n=On.get(e.player);if(On.set(e.player,Date.now()),!!n){if(!nr.includes(e.block.typeId)){if(n<Date.now()-tr)return;let o=(_n.get(e.player)??0)+1;_n.set(e.player,o),t.banPlayer&&o>=t.violationCount&&new $(e.player,null,"Using Nuker")}e.cancel=!0}})}).onDisable(()=>{Ie.unsubscribe($n)});var zn=new k,Ct=new k;function sr(t,e){return Math.hypot(e.x-t.x,e.z-t.z)}function ar(t){return(t.getEffect(ir.speed)?.amplifier??0)*Mn}function lr(t,e,n){let o=ar(n),r=Tt.currentTick-e,i=Rn.run.distance+.6;return t/r>o+i}function wt(t,e){let n=(zn.get(t)??0)+1;zn.set(t,n),L.delete(t),!(n<3)&&t.teleport(e.location,e.dimension,t.rotation.x,t.rotation.y)}function cr(t){let e=t.dimension.getBlock(we(t.location));if(!e.getTags().some(n=>It.includes(n))&&!e.type.id.endsWith("grass")&&!e.type.id.endsWith("water")&&!e.type.id.endsWith("lava")&&!e.type.id.endsWith("portal")&&!e.type.id.endsWith("gateway")&&e.typeId!=rr.air.id&&!e.type.canBeWaterlogged)return!0}var Vn=null,te=new R("movement","Blocks illegal movements on players","textures/ui/move.png",!1).setConfigDefault({tpCheck:{description:"If teleports should be flagged",defaultValue:!0}});te.onEnable(()=>{let t=te.getConfig();Vn=L.subscribe((e,n)=>{if(c(e)=="admin"||e.dimension.id!=n.dimension.id||e.getTags().some(r=>Bn.includes(r)))return;let o=sr(e.location,n.location);if(e.hasTag("skip-movement-check"))return e.removeTag("skip-movement-check");if(n.location.y!=Ln&&!Ct.has(e)){if(cr(e))return wt(e,n);if(o>Nn){if(!t.tpCheck)return;wt(e,n)}else{if(!lr(o,n.currentTick,e))return;wt(e,n)}}})}).onDisable(()=>{L.unsubscribe(Vn)});te.subscribe("dataDrivenEntityTriggerEvent",t=>{if(!(t.entity instanceof Ve)||t.id!="on_death")return;let e=t.entity;Tt.run(()=>{L.delete(e)})});te.subscribe("projectileHit",({projectile:t,source:e})=>{t.typeId==Et.enderPearl.id&&e instanceof Ve&&L.delete(e)});te.subscribe("itemCompleteCharge",({itemStack:t,source:e})=>{t.typeId==Et.chorusFruit.id&&e instanceof Ve&&L.delete(e)});te.subscribe("itemReleaseCharge",({itemStack:t,source:e})=>{t.typeId==Et.trident.id&&e instanceof Ve&&(Ct.set(e,!0),Tt.runSchedule(()=>{Ct.delete(e)},Dn))});var jn=new k,Yn=new k,Gn=new R("spam","Blocks spam in chat","textures/ui/mute_on.png",!1).setConfigDefault({permMutePlayer:{description:"If player should be permanently muted once violation count is met.",defaultValue:!1},violationCount:{description:"Violation count before permanent mute",defaultValue:0},repeatedMessages:{description:"Blocks repeated messages",defaultValue:!0},zalgo:{description:"Blocks zalgo",defaultValue:!0}});Gn.subscribe("beforeChat",t=>{try{if(t.message.startsWith(I)||["admin","moderator"].includes(c(t.sender)))return;let e=Gn.getConfig(),n=()=>{let o=(Yn.get(t.sender)??0)+1;Yn.set(t.sender,o),e.permMutePlayer&&o>=e.violationCount&&new x(t.sender,null,"Spamming")};if(e.repeatedMessages&&jn.get(t.sender)==t.message)return t.cancel=!0,n(),t.sender.tell("\xA7cRepeated message detected!");if(e.zalgo&&/%CC%/g.test(encodeURIComponent(t.message)))return t.cancel=!0,n(),t.sender.tell("\xA7cYou message contains some type of zalgo and cannot be sent!");jn.set(t.sender,t.message)}catch(e){console.warn(e+e.stack)}});import{MinecraftEffectTypes as mr,Player as ur,world as Kn}from"@minecraft/server";var dr=Kn.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{if(!(t.entity instanceof ur)||t.id!="rubedo:becomeAdmin")return;t.entity.removeTag("CHECK_PACK");let e=tn();if(e)return t.entity.playSound("note.bass"),t.entity.tell(`\xA7cFailed to give server owner: "${e}" is already owner!`),Kn.events.beforeDataDrivenEntityTriggerEvent.unsubscribe(dr);J(t.entity,"admin"),de(t.entity),t.entity.addEffect(mr.blindness,3,255,!0),t.entity.tell('\xA7aYou have now been set as the "owner" of this server. The command "/function start" will not do anything anymore, type "-help" for more information!')});import{DynamicPropertiesDefinition as Un,MinecraftEntityTypes as pr,world as qn}from"@minecraft/server";var Hn=[];qn.events.worldInitialize.subscribe(({propertyRegistry:t})=>{let e=new Un;e.defineString("role",30),t.registerEntityTypeDynamicProperties(e,pr.player);let n=new Un;n.defineString("worldsOwner",100),n.defineBoolean("isLockDown"),t.registerWorldDynamicProperties(n);for(let o of Hn)qn.scoreboard.addObjective(o.objective,o.displayName??"")});var Oe=[];function un(){Oe=[]}console.warn("----- Importing Plugins -----");fr.events.beforeWatchdogTerminate.subscribe(t=>{t.cancel=!0,console.warn(`WATCHDOG TRIED TO CRASH = ${t.terminateReason}`)});
//# sourceMappingURL=index.js.map
